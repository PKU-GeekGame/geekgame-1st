import random, time
from randcrack import RandCrack
from pwn import *

# p = process('./sweeper.py')
p = remote('prob09.geekgame.pku.edu.cn', 10009)
p.sendline(b'9:MEUCIQCGbOCjs6FlKPoG+d0G4JeNSy9EO3NPYmlq1P1AIL1v6AIgDOoxZYMtdQLmPqJ2u47fLRzeLOwwZDC15IIlPq57A0Y=')
p.recvline() # Welcome ...
p.sendline(b'y')
p.recvline() # easy mode ... New Game!

rc = RandCrack()

def trans(s):
    ret = 0
    for i in reversed(range(0,16)):
        if s[i] == '*':
            ret = (ret << 1) | 1
        else:
            ret = ret << 1
    return ret

for _ in range(78):
    # 78 * (16 * 16) = 624 * 32
    flag = True
    nx, ny = 0, 0
    while nx < 16:
        p.sendline('{} {}'.format(nx, ny).encode())
        res = p.recvline(keepends=False).decode().split()
        if len(res) >= 1 and res[1] == 'BOOM!':
            flag = False
            for _ in range(0, 8):
                l1 = p.recvline(keepends=False).decode()
                l2 = p.recvline(keepends=False).decode()
                print(l1, l2, (trans(l2)<<16)|trans(l1))
                rc.submit((trans(l2)<<16)|trans(l1))
            p.recvline() # \n
            p.sendline(b'y')
            p.recvline() # try again .. New Game!
            break
        ny += 1
        if ny >= 16:
            nx += 1
            ny = 0
    if flag:
        break

WIDTH = 16
HEIGHT = 16

print("=======START HACK==========")
bits = rc.predict_getrandbits(WIDTH * HEIGHT)
board = [[None] * WIDTH for _ in range(HEIGHT)]
for i in range(HEIGHT):
    for j in range(WIDTH):
        x = (bits >> (i * WIDTH + j)) & 1
        board[i][j] = x

for i in range(HEIGHT):
    for j in range(WIDTH):
        if board[i][j] == 0:
            print(i, j)
            p.sendline('{} {}'.format(i, j).encode())
            res = p.recvline(keepends=False).decode().split()
            print(res)

res = p.recvall()
print(res)

