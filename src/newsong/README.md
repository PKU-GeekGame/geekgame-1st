# “叶子的新歌” 相关内容说明

该目录中包含了在制作第一届 PKU GeekGame 竞赛中 “叶子的新歌” 一题时所使用的相关文件及源代码.

同时, 该文件中附加说明了你可能感兴趣的, 和本题相关的其他内容.

## 相关文件/源代码

### `bar2histogram.py`

Python 脚本, 可根据条码图片和任意参考图片, 生成直方图中嵌入了条码的灰度图片.

### `boot.asm`

x86 汇编程序, FAT12 软盘镜像的引导扇区. 可使用 NASM 进行汇编.

该程序的主要功能是利用 `int 0x10` 向屏幕上输出包含 flag2 和最终密码的字符串. 但为了避免解题者直接从软盘的二进制中读出这一字符串, 字符串被预先与一个常数 (132) 做了逐字符异或. 所以该程序会先将字符串解密, 然后再逐字符输出.

### `xor132.py`

Python 脚本, 用来生成引导程序用到的逐字符异或加密后的字符串.

### `bindiffgen.py`

Python 脚本, 可根据输入的二进制文件, 生成两个新的二进制文件. 新文件 `diff` 后的结果是输入的二进制.

### `dream.nes`

NES ROM, 其中隐藏了 flag3 的最终网址, 由 `Super Mario Bros. (JU) [!]` NES ROM 修改得到.

ROM 主要修改了三个地方:

* **标题**: 将原版标题里的 `SUPER MARIO BROS.` 图案去掉了, 换成了 `DREAM.`. 同时把原先的 `(C)1985 NINTENDO` 改成了 `2021 GEEKGAME` (东半球最强法务部警告).
* **图像**: 将原版的 `(C)` 文字的图像改成了斜杠 (`/`), 以便在通关之后显示网址.
* **文字**: 将所有 `MARIO` 和 `LUIGI` 都改成了 `YE ZI` (“小雨” 写拼音太长了塞不进去), 同时修改了通关之后的文本, 添加了 flag3 路线最终页面的网址.

修改初代超级马里奥兄弟 NES ROM 的相关工具见 MaxXing 很久以前的[永硕网盘](http://lovebbb.ys168.com/)中的 `SMB1修改工具` 目录. 这些工具基本都是 2010 年收集的, 已经相当古早了.

### `final.php`

PHP/HTML 文件, flag3 路线的最终页面, 揭示了故事的结局.

### `add_metadata.sh`

Shell 脚本, 使用 `ffmpeg` 为 MP3 文件添加专辑封面等 ID3v2 标签.

## 全文本

### Part 1

> 出现于 MP3 的 ID3v2 注释标签.

你还记得吗？小时候，我家和你家都在一个大院里。放学以后，我们经常一起在院子里玩。你虽然是个女孩子，但总是能和男孩子们玩到一块去。

夏天的时候我们挖蚯蚓、捉蚂蚱；冬天，院子里的大坡上积了一层雪，我们就坐在纸箱子压成的雪橇上，一次次从坡顶滑到坡底。那个时候你还发现，坐在铁簸箕上滑得更快。

——当然，那次你也摔得挺惨的。

### Part 2

> 出现于 flag1 路线结尾.

你还记得高中的时候吗？那时在市里的重点中学，我们是同桌。我以前还怪讨人嫌的，老是惹你生气，然后你就不和我说话，我就死乞白赖地求你，或者讲笑话逗你。

不过，你笑起来好可爱，从小就好可爱。此后的一切，也都是从那个笑容开始的吧。

真的，好想回到那个时候啊。

### Part 3

> 出现于 flag2/3 路线软盘附带的提示文本.

我有一张很久很久以前的软盘。说起来以前的操作系统还能装在软盘里，把软盘放进电脑就可以启动，很神奇吧？我给你看过这张软盘，但你总说这是Word保存图标的手办……什么跟什么啦！

现在已经没有带软驱的电脑了，甚至连带光驱的电脑都没有了。以前软盘里的那些东西，也许再也启动不了了吧。

时间过得好快啊，转眼间，就来到了现实。

### Part 4

> 出现于 flag3 路线二进制文件找不同附带的提示文本.

我以前很喜欢玩红白机，当然，现在也很喜欢。超级马里奥、魂斗罗、坦克大战、马戏团、冒险岛……一玩能玩一天。

小时候家里有一台红白机，也经常叫你一起玩游戏，只不过，我记得你不喜欢这些东西。你最喜欢在4399玩找不同，而且你还玩的特别棒，简直就是找不同滴神。

呜呜，红白机已经属于时代的眼泪了。

### Ending

> 出现于 flag3 路线结尾.

说了那么多的回忆，不如，再来聊聊现在吧。

那天和你表白之后，我们正式在一起了。回想起那段日子，整个世界都是彩色的，在校园里的每一天，我和你都很开心。

但，如果你没有在8月15号出去练琴，如果你没有经过那个十字路口，如果那辆卡车没有超速。

如果。

如果这个世界上真的有如果。

从那之后到现在，你已经昏迷整整三年了。

大夫说，你失去了所有的记忆，再也想不起我们的从前，变成了一个无意识的植物人。

但我依然相信，只要我每天都在床边陪着你，和你讲以前的故事，奇迹就一定会发生。

如果你在那个悠长的梦里，看到了这条消息，请一定记得：

从你的世界里醒过来，然后——

**回家吧。**

## 音乐/Vocaloid 工程

叶子的新歌使用 Logic Pro X + Logic 内置音源/采样/效果器编曲, 使用 Vocaloid 5 编辑器 + 乐正绫 V3 音源生成人声.

工程文件见 `music-projects.zip`, 仅供学习/二次创作使用, 请勿作商业用途.

当然, MaxXing 本人不懂 V 家调教不懂乐器更不懂乐理, 工程文件里的所有内容 (包括钢琴踏板曲线和弦乐的表情曲线) 都是我鼠标搓出来的, 难免存在若干不合常理之处, 还请专业人士多批评指正.
