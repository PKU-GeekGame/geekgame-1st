{"version":3,"sources":["infrastructure/functions.js","infrastructure/widgets.js","infrastructure/const.js","infrastructure/appicon/hole.png","infrastructure/appicon/imasugu.png","infrastructure/appicon/imasugu_rev.png","infrastructure/appicon/syllabus.png","infrastructure/appicon/score.png","infrastructure/appicon/course_survey.png","infrastructure/appicon/dropdown.png","infrastructure/appicon/dropdown_rev.png","infrastructure/appicon/homepage.png","color_picker.js","text_splitter.js","cache.js","flows_api.js","Common.js","react-lazyload/src/utils/event.js","react-lazyload/src/utils/scrollParent.js","react-lazyload/src/index.jsx","react-lazyload/src/utils/debounce.js","react-lazyload/src/utils/throttle.js","AudioWidget.js","Message.js","Config.js","UserAction.js","Captcha.js","Flows.js","Title.js","Sidebar.js","PressureHelper.js","App.js","registerServiceWorker.js","index.js"],"names":["get_json","res","ok","Error","status","statusText","text","then","t","JSON","parse","e","console","error","trace","log","SyntaxError","substr","listen_darkmode","override","update_color_scheme","undefined","window","matchMedia","matches","document","body","classList","add","remove","addListener","API_VERSION_PARAM","encodeURIComponent","Math","floor","Date","LOGIN_POPUP_ANCHOR_ID","pad2","x","format_time","time","getMonth","getDate","getHours","getMinutes","getSeconds","chinese_format","buildFormatter","chineseStrings","Time","props","stamp","date","formatter","title","toLocaleString","timeZone","hour12","TitleLine","className","GlobalTitle","FALLBACK_APPS","bar","appicon_hole","appicon_imasugu","appicon_imasugu_rev","appicon_syllabus","appicon_score","dropdown","appicon_course_survey","appicon_homepage","fix","SWITCHER_DATA_VER","SWITCHER_DATA_URL","AppSwitcher","state","apps","get_apps_from_localstorage","ret","localStorage","content","this","appid","setTimeout","HOTFIX_CONTEXT","build_info","process","build_env","eval","check_fix","fetch","txt","setState","catch","prevProps","prevState","cur_id","app_elem","id","url","icon_normal","icon_hover","new_tab","no_class","ref","key","href","target","src","dropdown_cur_app","forEach","app","map","length","appicon_dropdown","appicon_dropdown_rev","React","createRef","onClick","closest","current","click","Component","LoginPopupSelf","loading_status","input_token_ref","popup_anchor","getElementById","createElement","appendChild","set_token","token","value","QKUHELPER_ROOT","json","result","on_close","alert","ReactDOM","createPortal","style","backgroundColor","LoginPopup","popup_show","on_popup_bound","on_popup","bind","on_close_bound","children","token_callback","module","exports","ColorPicker","names","current_h","random","name","toLowerCase","PID_RE","URL_PID_RE","NICKNAME_RE","URL_RE","split_text","rules","rule","regex","concat","apply","part","split","seg","test","filter","HOLE_CACHE_DB_NAME","CACHE_DB_VER","Cache","db","added_items_since_maintenance","encrypt","decrypt","open_req","indexedDB","open","onerror","onupgradeneeded","event","createObjectStore","keyPath","createIndex","unique","onsuccess","maintenance","pid","data","s","stringify","o","i","new_key","charCodeAt","String","fromCharCode","c","target_version","parseInt","Promise","resolve","reject","get_req","store","tx","transaction","objectStore","get","data_str","version","last_access","put","delete","warn","req","count_req","count","index","openKeyCursor","cur","primaryKey","continue","deleteDatabase","cache","hole_cache","token_param","API","load_replies","color_picker","cache_version","API_BASE","code","msg","captcha","sort","a","b","cid","info","_display_color","variant","load_replies_with_cache","set_attention","attention","URLSearchParams","append","method","headers","report","reason","get_list","page","get_search","keyword","get_single","get_attention","escape_regex","string","replace","build_highlight_re","option","RegExp","join","ColoredSpan","colors","HighlightedText","parts","idx","p","rel","preventDefault","show_pid","PureComponent","TEXTAREA_BACKUP","SafeTextarea","on_change_bound","on_change","on_keydown_bound","on_keydown","clear","area_ref","change_callback","submit_callback","on_submit","ctrlKey","altKey","focus","onChange","onKeyDown","pwa_prompt_event","PromotionBar","is_ios","navigator","userAgent","standalone","prompt","addEventListener","ClickHandler","moved","init_y","init_x","on_begin_bound","on_begin","on_move_bound","on_move","on_end_bound","on_end","MOVE_THRESHOLD","last_fire","touches","screenY","screenX","abs","do_callback","callback","onTouchStart","onMouseDown","onTouchMove","onMouseMove","on","el","eventName","opts","attachEvent","call","off","removeEventListener","detachEvent","node","HTMLElement","documentElement","excludeStaticParent","position","overflowRegex","parent","parentNode","ownerDocument","getComputedStyle","overflow","overflowX","overflowY","defaultBoundingClientRect","LISTEN_FLAG","listeners","pending","passiveEventSupported","Object","defineProperty","delayType","passiveEvent","capture","passive","checkVisible","component","ReactDom","findDOMNode","scrollParent","parentTop","parentHeight","getBoundingClientRect","top","height","windowInnerHeight","innerHeight","clientHeight","intersectionTop","max","intersectionHeight","min","offsetTop","offsets","Array","isArray","offset","checkOverflowVisible","elementHeight","offsetWidth","offsetHeight","getClientRects","checkNormalVisible","visible","hidden","once","push","unmountIfInvisible","hiddenIfInvisible","lazyLoadHandler","listener","indexOf","splice","finalLazyLoadHandler","LazyLoad","scrollport","scrollContainer","querySelector","needResetFinalLazyLoadHandler","debounce","func","wait","immediate","timeout","args","context","timestamp","later","last","arguments","callNow","throttle","fn","threshhold","scope","deferTimer","now","clearTimeout","getAttribute","listenerCount","setAttribute","scroll","resize","removeAttribute","visibility","placeholder","defaultProps","audio_cache","AudioWidget","all","AMR","load","err","blob","reader","FileReader","onload","raw","decode","wave","PCMData","encode","sampleRate","channelCount","bytesPerSample","binary_wave","Uint8Array","objurl","URL","createObjectURL","Blob","type","readAsBinaryString","controls","MessageViewer","BUILTIN_IMGS","DEFAULT_CONFIG","background_img","background_color","pressure","easter_egg","color_scheme","load_config","loaded_config","config","assign","keys","save_config","bgimg_style","img","color","background","backgroundImage","encodeURI","backgroundSize","ConfigBackground","save_changes","img_select","on_select","on_change_img","on_change_color","ConfigColorScheme","ConfigSwitch","switch","val","checked","description","ConfigUI","save_changes_bound","chg","confirm","location","reload","reset_settings","MAX_IMG_DIAM","MAX_IMG_PX","MAX_IMG_FILESIZE","TokenCtx","createContext","set_value","todo_alert","InfoSidebar","show_sidebar","serviceWorker","getRegistrations","registrations","registration","unregister","ResetUsertokenWidget","uid","user_token","do_reset","LoginForm","copy","Consumer","copy_token","do_popup","ReplyForm","global_keypress_handler_bound","global_keypress_handler","tagName","on_complete","onSubmit","disabled","PostForm","img_tip","img_ref","on_img_change_bound","on_img_change","file","return_url","fixOrientation","fixed_dataurl","image","Image","width","compressed","rate","sqrt","canvas","ctx","getContext","drawImage","quality","new_url","quality_l","quality_r","toDataURL","round","on_got_img","readAsDataURL","files","proc_img","d","do_post","accept","KEY_MAX","RECAPTCHA_KEY","CaptchaCtx","get_key","add_listener","k","remove_listener","CaptchaSelf","useState","portal_dom","exe_recaptcha","useGoogleReCaptcha","executeRecaptcha","useContext","hint_msg","set_hint_msg","run_captcha","captcha_result","onFinish","useEffect","removeChild","CaptchaRoot","useRef","should_show_self","set_should_show_self","Provider","some","ik","reCaptchaKey","language","useRecaptchaNet","l","slice","CaptchaClient","IMAGE_BASE","AUDIO_BASE","CLICKABLE_TAGS","audio","QUOTE_BLACKLIST","LATEST_POST_ID","load_single_meta","title_elem","single","reply","replies","deletion_detect","Reply","do_filter_name","tag","FlowItem","likenum","r","is_quote","copy_link","img_clickable","latest_reply","FlowSidebar","error_msg","filter_name","rev","syncState","sync_state","reply_ref","prev","update_count","set_variant","next_attention","should_text","set","replies_to_show","reverse","view_mode_key","replies_cnt","main_thread_elem","show_reply_bar","set_filter_name","toggle_rev","toggle_attention","float","FlowItemRow","reply_status","reply_error","attention_override","hl_rules","search_param","quote_id","mode","FlowItemQuote","FlowChunk","list","ind","Flow","search_text","loaded_pages","chunks","on_scroll_bound","on_scroll","failed","max_id","finished","scrollHeight","scrollY","load_page","should_deletion_detect","flag_re","ControlBar","set_mode","on_keypress_bound","on_keypress","do_refresh_bound","do_refresh","do_attention_bound","do_attention","hash","decodeURIComponent","lastIndexOf","flag_res","exec","startsWith","scrollTo","onKeyPress","Title","Sidebar","sidebar_ref","do_close_bound","do_close","do_back_bound","do_back","nextProps","stack","scrollTop","cur_title","cur_content","onTouchEnd","PressureHelper","level","fired","esc_interval","clearInterval","Pressure","change","force","do_fire","end","polyfill","only","preventSelect","repeat","THRESHOLD","setInterval","new_level","pad","left","right","bottom","DeprecatedAlert","display","App","default","light","dark","sidebar_stack","flow_render_key","show_sidebar_bound","set_mode_bound","on_pressure_bound","on_pressure","ns","pop","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","register","onupdatefound","installingWorker","installing","onstatechange","controller","render","origin","response","ready","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.10d47545.chunk.js","sourcesContent":["export function get_json(res) {\r\n    if(!res.ok) throw Error(`网络错误 ${res.status} ${res.statusText}`);\r\n    return (\r\n        res\r\n            .text()\r\n            .then((t)=>{\r\n                try {\r\n                    return JSON.parse(t);\r\n                } catch(e) {\r\n                    console.error('json parse error');\r\n                    console.trace(e);\r\n                    console.log(t);\r\n                    throw new SyntaxError('JSON Parse Error '+t.substr(0,50));\r\n                }\r\n            })\r\n    );\r\n}\r\n\r\nexport function listen_darkmode(override) { // override: true/false/undefined\r\n    function update_color_scheme() {\r\n        if(override===undefined ? window.matchMedia('(prefers-color-scheme: dark)').matches : override)\r\n            document.body.classList.add('root-dark-mode');\r\n        else\r\n            document.body.classList.remove('root-dark-mode');\r\n    }\r\n\r\n    update_color_scheme();\r\n    window.matchMedia('(prefers-color-scheme: dark)').addListener(()=>{\r\n        update_color_scheme();\r\n    });\r\n}\r\n\r\nexport function API_VERSION_PARAM() {\r\n    return '&QKUHelperAPI=3.0&jsapiver='+encodeURIComponent((process.env.REACT_APP_BUILD_INFO||'null')+'-'+(Math.floor(+new Date()/7200000)*2));\r\n}","import React, {Component, PureComponent} from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nimport TimeAgo from 'react-timeago';\r\nimport chineseStrings from 'react-timeago/lib/language-strings/zh-CN';\r\nimport buildFormatter from 'react-timeago/lib/formatters/buildFormatter';\r\n\r\nimport './global.css';\r\nimport './widgets.css';\r\n\r\nimport appicon_hole from './appicon/hole.png';\r\nimport appicon_imasugu from './appicon/imasugu.png';\r\nimport appicon_imasugu_rev from './appicon/imasugu_rev.png';\r\nimport appicon_syllabus from './appicon/syllabus.png';\r\nimport appicon_score from './appicon/score.png';\r\nimport appicon_course_survey from './appicon/course_survey.png';\r\nimport appicon_dropdown from './appicon/dropdown.png';\r\nimport appicon_dropdown_rev from './appicon/dropdown_rev.png';\r\nimport appicon_homepage from './appicon/homepage.png';\r\nimport {QKUHELPER_ROOT} from './const';\r\nimport {get_json, API_VERSION_PARAM} from './functions';\r\n\r\nconst LOGIN_POPUP_ANCHOR_ID='qkuhelper_login_popup_anchor';\r\n\r\nfunction pad2(x) {\r\n    return x<10 ? '0'+x : ''+x;\r\n}\r\nexport function format_time(time) {\r\n    return `${time.getMonth()+1}-${pad2(time.getDate())} ${time.getHours()}:${pad2(time.getMinutes())}:${pad2(time.getSeconds())}`;\r\n}\r\nconst chinese_format=buildFormatter(chineseStrings);\r\nexport function Time(props) {\r\n    const time=new Date(props.stamp*1000);\r\n    return (\r\n        <span>\r\n            <TimeAgo date={time} formatter={chinese_format} title={time.toLocaleString('zh-CN', {\r\n                timeZone: 'Asia/Shanghai',\r\n                hour12: false,\r\n            })} />\r\n            &nbsp;\r\n            {format_time(time)}\r\n        </span>\r\n    );\r\n}\r\n\r\nexport function TitleLine(props) {\r\n    return (\r\n        <p className=\"centered-line title-line aux-margin\">\r\n            <span className=\"black-outline\">{props.text}</span>\r\n        </p>\r\n    )\r\n}\r\n\r\nexport function GlobalTitle(props) {\r\n    return (\r\n        <div className=\"aux-margin\">\r\n            <div className=\"title\">\r\n                <p className=\"centered-line\">{props.text}</p>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nconst FALLBACK_APPS={\r\n    // id, text, url, icon_normal, icon_hover, new_tab\r\n    bar: [\r\n        ['hole', '树洞', '#', appicon_hole, null, false],\r\n        ['imasugu', '教室', '#', appicon_imasugu, appicon_imasugu_rev, false],\r\n        ['syllabus', '课表', '#', appicon_syllabus, null, false],\r\n        ['score', '成绩', '#', appicon_score, null, false],\r\n    ],\r\n    dropdown: [\r\n        ['course_survey', '课程测评', '#', appicon_course_survey, null, false],\r\n        ['homepage', '客户端', '#', appicon_homepage, null, false],\r\n    ],\r\n    fix: {},\r\n};\r\nconst SWITCHER_DATA_VER='switcher_2';\r\nconst SWITCHER_DATA_URL='static/appswitcher_items.json';\r\n\r\nexport class AppSwitcher extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            apps: this.get_apps_from_localstorage(),\r\n        }\r\n    }\r\n\r\n    get_apps_from_localstorage() {\r\n        let ret=FALLBACK_APPS;\r\n        if(localStorage['APPSWITCHER_ITEMS'])\r\n            try {\r\n                let content=JSON.parse(localStorage['APPSWITCHER_ITEMS'])[SWITCHER_DATA_VER];\r\n                if(!content || !content.bar)\r\n                    throw new Error('content is empty');\r\n\r\n                ret=content;\r\n            } catch(e) {\r\n                console.error('load appswitcher items from localstorage failed');\r\n                console.trace(e);\r\n            }\r\n\r\n        return ret;\r\n    }\r\n\r\n    check_fix() {\r\n        if(this.state.apps && this.state.apps.fix && this.state.apps.fix[this.props.appid])\r\n            setTimeout(()=>{\r\n                window.HOTFIX_CONTEXT={\r\n                    build_info: process.env.REACT_APP_BUILD_INFO || '---',\r\n                    build_env: process.env.NODE_ENV,\r\n                };\r\n                eval(this.state.apps.fix[this.props.appid]);\r\n            },1); // make it async so failures won't be critical\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.check_fix();\r\n        setTimeout(()=>{\r\n            fetch(SWITCHER_DATA_URL)\r\n                .then((res)=>{\r\n                    if(!res.ok) throw Error(`网络错误 ${res.status} ${res.statusText}`);\r\n                    return res.text();\r\n                })\r\n                .then((txt)=>{\r\n                    if(txt!==localStorage['APPSWITCHER_ITEMS']) {\r\n                        console.log('loaded new appswitcher items',txt);\r\n                        localStorage['APPSWITCHER_ITEMS']=txt;\r\n\r\n                        this.setState({\r\n                            apps: this.get_apps_from_localstorage(),\r\n                        });\r\n                    } else {\r\n                        console.log('appswitcher items unchanged');\r\n                    }\r\n                })\r\n                .catch((e)=>{\r\n                    console.error('loading appswitcher items failed');\r\n                    console.trace(e);\r\n                });\r\n        },500);\r\n    }\r\n\r\n    componentDidUpdate(prevProps, prevState) {\r\n        if(this.state.apps!==prevState.apps)\r\n            this.check_fix();\r\n    }\r\n\r\n    render() {\r\n        let cur_id=this.props.appid;\r\n\r\n        function app_elem([id,title,url,icon_normal,icon_hover,new_tab],no_class=false,ref=null) {\r\n            return (\r\n                <a ref={ref} key={id} className={no_class ? null : ('app-switcher-item'+(id===cur_id ? ' app-switcher-item-current' : ''))}\r\n                   href={url} target={new_tab ? '_blank' : '_self'}>\r\n                    {!!icon_normal && [\r\n                        <img key=\"normal\" src={icon_normal} className=\"app-switcher-logo-normal\" />,\r\n                        <img key=\"hover\" src={icon_hover||icon_normal} className=\"app-switcher-logo-hover\" />\r\n                    ]}\r\n                    <span>{title}</span>\r\n                </a>\r\n            );\r\n        }\r\n\r\n        let dropdown_cur_app=null;\r\n        this.state.apps.dropdown.forEach((app)=>{\r\n            if(app[0]===cur_id)\r\n                dropdown_cur_app=app;\r\n        });\r\n\r\n        //console.log(JSON.stringify(this.state.apps));\r\n\r\n        return (\r\n            <div className=\"app-switcher\">\r\n                <span className=\"app-switcher-desc app-switcher-left\">Q小助手</span>\r\n                {this.state.apps.bar.map((app)=>\r\n                    app_elem(app)\r\n                )}\r\n                {!!this.state.apps.dropdown.length &&\r\n                    <div className={\r\n                        'app-switcher-item app-switcher-dropdown '\r\n                        +(dropdown_cur_app ? ' app-switcher-item-current' : '')\r\n                    }>\r\n                        <p className=\"app-switcher-dropdown-title\">\r\n                            {!!dropdown_cur_app ?\r\n                                app_elem((()=>{\r\n                                    let [id,title,_url,icon_normal,icon_hover,_new_tab]=dropdown_cur_app;\r\n                                    return [id,title+'▾',null,icon_normal,icon_hover,false];\r\n                                })(),true) :\r\n                                app_elem(['-placeholder-elem','更多▾',null,appicon_dropdown,appicon_dropdown_rev,false],true)\r\n                            }\r\n                        </p>\r\n                        {this.state.apps.dropdown.map((app)=>{\r\n                            let ref=React.createRef();\r\n                            return (\r\n                                <p key={app[0]} className=\"app-switcher-dropdown-item\" onClick={(e)=>{\r\n                                    if(!e.target.closest('a') && ref.current)\r\n                                        ref.current.click();\r\n                                }}>\r\n                                    {app_elem(app,true,ref)}\r\n                                </p>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                }\r\n                <span className=\"app-switcher-desc app-switcher-right\">网页版</span>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nclass LoginPopupSelf extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            loading_status: 'idle',\r\n        };\r\n        this.input_token_ref=React.createRef();\r\n\r\n        this.popup_anchor=document.getElementById(LOGIN_POPUP_ANCHOR_ID);\r\n        if(!this.popup_anchor) {\r\n            this.popup_anchor=document.createElement('div');\r\n            this.popup_anchor.id=LOGIN_POPUP_ANCHOR_ID;\r\n            document.body.appendChild(this.popup_anchor);\r\n        }\r\n    }\r\n\r\n    do_input_token(set_token) {\r\n        let token=this.input_token_ref.current.value;\r\n        if(!token)\r\n            return;\r\n\r\n        if(this.state.loading_status==='loading')\r\n            return;\r\n\r\n        this.setState({\r\n            loading_status: 'loading',\r\n        },()=>{\r\n            fetch(QKUHELPER_ROOT+'api_xmcp/hole/system_msg?user_token='+encodeURIComponent(token)+API_VERSION_PARAM())\r\n                .then((res)=>res.json())\r\n                .then((json)=>{\r\n                    if(json.error)\r\n                        throw new Error(json.error);\r\n                    if(json.result.length===0)\r\n                        throw new Error('result check failed');\r\n                    this.setState({\r\n                        loading_status: 'done',\r\n                    });\r\n                    set_token(token);\r\n                    this.props.on_close();\r\n                })\r\n                .catch((e)=>{\r\n                    alert('Token检验失败\\n'+e);\r\n                    this.setState({\r\n                        loading_status: 'done',\r\n                    });\r\n                    console.error(e);\r\n                });\r\n        });\r\n    }\r\n\r\n    render() {\r\n        return ReactDOM.createPortal(\r\n            <div>\r\n                <div className=\"qkuhelper-login-popup-shadow\" />\r\n                <div className=\"qkuhelper-login-popup\">\r\n                    <p>\r\n                        <b>接收验证码来登录 Q小树洞</b>\r\n                    </p>\r\n                    <p style={{backgroundColor: 'yellow'}}>\r\n                        前面的区域以后再来探索吧！\r\n                    </p>\r\n                    <hr />\r\n                    <p>\r\n                        <button onClick={this.props.on_close}>\r\n                            取消\r\n                        </button>\r\n                    </p>\r\n                </div>\r\n            </div>,\r\n            this.popup_anchor,\r\n        );\r\n    }\r\n}\r\n\r\nexport class LoginPopup extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            popup_show: false,\r\n        };\r\n        this.on_popup_bound=this.on_popup.bind(this);\r\n        this.on_close_bound=this.on_close.bind(this);\r\n    }\r\n\r\n    on_popup() {\r\n        this.setState({\r\n            popup_show: true,\r\n        });\r\n    }\r\n    on_close() {\r\n        this.setState({\r\n            popup_show: false,\r\n        });\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <>\r\n                {this.props.children(this.on_popup_bound)}\r\n                {this.state.popup_show &&\r\n                    <LoginPopupSelf token_callback={this.props.token_callback} on_close={this.on_close_bound} />\r\n                }\r\n            </>\r\n        );\r\n    }\r\n}","export const QKUHELPER_ROOT='/mock_api/';\r\n","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAC4jAAAuIwF4pT92AAAIoElEQVR42rVWaWwU5xn+dqGHVPCPQhMRsGXjIAKp1ASp0KhJo6qlTQq2fDYipN7d0ewcHV8CO8gHbh2wfGp3vTOZmTUWBArFXHUjFGiROewa0kNqkiJRUkUkMQ2lXD4SQ/DOfG/f75u1GwjmUNMfr2a11/O8z/s87/cR0zTJfZdhEAOLPeOWSU7XN8w+Lfxydudtnz3Ifz4YOD4tXScdlk1ONm2aSQPCIZol/26wbPPMji2Wj31mpL77xRPASnXoj5oWuV5RKkNABMhUYHxZ5c+jCQ7sN/4vCqTktQzDF7Es39831j8CkvBPGpIcd7HqwEPyhTOBhvkRroLhe5BR3D9blDdmWf6eSIRQSYyDIgISSNJFSpLOV4EuVF7taY6SmG362Xe/UAVS3fs7bJucr3l5BYjCDapKLgTDLn1Udd1MzYWH5RtDubVPoRfQJ/c/inuDp4zXjtKf3Lx5BoihPipLAErYgZBE6SKV0nTVcbM0gHnhY4OVm2a0s1HEU4b8nwikZo/lx9mT8Yqyn0FYACojuCq6SACQALgLNNfNUpPwiAyfLF8XiCYs/hvDvLcX7tk9+4MO7P7duto5CH4OwSlI4SSo+JxSQKM0E1XIVCnMU95/N1A3l8XS1I17qnDX7lnFTMvHjRcWWhAcpUfjyTKlKr4OhgE9AG46VqbCSCRpugJutty+uzmCpjV95j0ScdelY2PsWu0EGard8C2c/RhVJAdYSSEkIlDKR6AALNAoZGASMtGQWRqL5ccf5tc+2brVJlYcY3mX5XRX6bF7/4FIh89RpIO8e1lKgizSIa2OjmmVqIDIFRjJUuHcIlQgQ2WFKqjgZKlvHHgl4uexNKYfxbTd49PXaZjkenlpETce61wW3DG1ApbVnISm6l0AgSBAtgYbnlAg/bsyjCxENTI06mRpSZgnw/jyip/GLexcn16FaWPXYid8A01NaSj9GQSnGD0kEKIjaiVdUvtHqK/eAzQYQgU0KH9ChjlPy3BtoUIZATdDYbGk9GH5bH9Fc1rLVnvaWN7ReHi6+XbGYuSmpjSAJAKfu4Ku52MQ4Z2yzXCp9GVUoAQVUOHiQhX+8pgClPkgQwM+CkwFna/Ap0tLG3e2RUnnNIa802nna8GN92FtzWIQgiPYvYuzdxk4V0LBJSSh9HIIDqmt8Jsn16EJUfp0DZPA0sB8wEkwQ7owVxr9oKBuSQs3pP65UdzBeKavt72doPF2p4zndY/g6AGuAHvfUTV4Zv0b8PizVXAzQ+bgLAnAwD0SzJAON2S2tre3sZ2dE5/bDbdeNHTdzy4X18u159F4jhe7sDsp/WWtCq4rZagANyVUVuwA8TtVuAdkDvwJpuHf2SkSPJa4IXEUaEh3fEX5qk6bH2r+z56WtxivzbZ9A81NX0Pwt7jUuHIpn71AxxH4ezX90LZ+pzcCJQyfCircWIxgCxAUO63HNCx9SuZEUA3qjYOfE7gh5bf7K5tntXXfakgyua9xa/l3xiJkQpXXe9Ljup2auQCjaiU8WvdnqKreP0UAMAWQjeZboHEC4WUKpD0jwfBCjxAbC6rgbUgkefObWvWvolESndoNBipgsBHoJGLYZGhDTSZuuUue8fDAYXs/5X5G6mR5G+AS4oQYgQNaO+xatg4ojoAZ7xweTMeWTCXBA+fJ4Cq4ME+6PJRflx1N2ByTYRPD0okdsXyt+zrI+a7gNliL61ULJ/mho0hepwpXBIu53zOio6rwdNUhWIomnEAT0kkTpmsegUxuxkkS1MnG0/LrGvxtjbyjYXeUdMUsn84UQEPMMKMWiZ3Rnt1xoWBivE50oERyqcryz7pnJLyiiszNRyUeSaip2AZlK6qmFHAQ0OGgqcpIRTMLYzpXda99W3XE3wYnpENV30/ETaLjkU2Mlm6fcbhhljGaMxgdLoRtHxUlr8Sw05cwdmEEUsNTBP6rhKeKg4dRcpFnwknAVNe8HGZGZtC5Kj33vAKh18XkTwZEyB146VTjrk2z7E7bxwgQfajkufhIHhiXi5Kx4UK382ohvH14LXXKREYEQGQdT5Lx/ADsdSjMT0OXyY63Y7yaYbee+QDviTBHg5voi95qieYeF2BVv+AW9YnJnBNBCPVpz3VHthCit3X5jL76NGMk79fxK4VgXi5y9KuFTttYAez8oJi+11NCJ9aL/OzH0QAIWGGmBr+UgosALAVs4cA8rG9gPYTxfFyFQVGi2n6R/vBNAfKPC05Rn+DkHRNQgUDPxj2NaZ4CFq7H9i5iHKn/Unw0N6IP54N+uZgRmWBqtI8WwvbzxfTUwIv0oy0BGN8YAqc8pQgSolkqH8HNxQoML1fgdLEMr70iUbFXpCtPYdcDrGthovAoSn88BHmDgc6GnsYvJzoTRDd1L4Ysj0bMJsbeZqK/H1yrj+Wc168UIQlOhI8FFaEdo4XUvlREd6EyB8++AAf/ugbaukWo7w5D6T6RvnBEpD8eFOjKNwW6msl9VExiQT7Wqj+UXAj+Xitpfa2N2HErtX/4IjI9EhhHI5rwGVacGIPV81EJXR/NHTWGC9AbnAidHA+a1YmOFrjN14rcnD8F3R9hl6sHQk7eCZT5qOgU94mUdZyHHef0Bz4uGAi8Wr2/PkPH/2ay6ylwbxGZ5hQbEy8Pho5bKoLy7EM1zqqP6RfWtCKRf+hoUp2RuVKMIyoCC/0SvVgML54IQcEREQqPCjApc05/EFYPlLy3pk9u1w6vW9q6vZUk4mz5mH7jM+C33QfYgZR6WniDidl+A4kYtk70U1Wz9XPCD/QLa3+B4+nFxLxljuUOdVzN/1fhqZKLq04EzqOx3skdLHl9bZ/SKB4pXVnbW5cWR1UTnTZKbjNg3+3g09yIUmqwp63jJcKcaXR0EbNpmzem/c3E2NNKzL0tPr2n5Sut29q/ijUDi7RubyMWEt4a6SbMZOy3ujUJbNwCPFn/Abg0oqXmwyKAAAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,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\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAC4jAAAuIwF4pT92AAAFn0lEQVR42q1XbUidZRh+z/FjavYjGLFFFASrFREx1ikE6Ye50QZ5lBUO/ZEnhMyfWbSQQGxQofu1MGooKGjaNCTRpiu3+ZH+Muc8X87j0ZPf39/f2nWd7keenalHSeHifXzf53nu67nv677v5xgjIyOGjtHR0Z0nMT4+bpqYmAgZHh4O8/l8YYODg/7n2NhYKN6b8HxkTeB+wWDsRwBGTTBm9PX1GTBmzM7OGjMzM/4nvhler9c/5/+Q2NUwNxwaGvI/NzY2iNNbW1vvbW9vfwRkApfxv2V9fT1qcnLSIElF5LAkHjs9wZMtLS0ZMPQOUAx0An2AD/gH6AecQA1gA8EnSASkD01ix6haQFevrq5GYuOvgV5gAHADPcBDQY+88wipX+CRl8RzhyKxM+AinlyM/wAMAXYx5Nrc3GxbW1u7he91OPE9GOwmETwfCMkmjE/zANTHoT3ARcvLy3T7VzQuG/fAWFNLS8s3KSkpH1oslovAu3FxcckFBQVXML8a89xChqH5DfOfoiZ0YQYlgIGJ/2CDt3habGgHenDa2oyMjMuxsbEvFBYWRhcVFYUQGEfk5uaeiImJiYOhG5jr0kh8Oj09veOFYCT8TDl5fn6eBK5zE25Il6elpSXl5+cf4ybcVMfc3JxRVVVlwCOvLy4uUgMPSRrrm+GFpwcGBgylhX0JIGbm/v5+ptozWPyXbOLp7OzMycvLC2feYyMTSQbAxG/FxcVGdna2lSEDmBkePC+KB0wH8UAoqhsJxFJwJAB0lpaWnuV7ZVzfSI35fmpqyqivr49GuCqZNVhLQX62sLBgYL0pmBc4KYwuxaJELO4DPHD/7xDSk/ulkxIu8t8EbxkIA9O2Xwh8x5CqYhZMhGEcwAMfsNgIiSooPERtsJcbpWqaqXqs/4LpKATyqZEDEcDpQ51OJ09yXlzI4nMXLj2u0inQC0rd/EY3S9W8jrWskAMgkyPED6QBdjoSeZWxZwaIkC7ICcyB6aTG1AdJImQUcCtrAp5ekLK1t7dTH6agWUA1U0iVlZXRaC6VUl5Z93+FF6IlnUJ4ogDQ9WatePn7A0jcb2xsPNPb28tWbhyEgF/JdXV1Rltb28dyehYVL2MJElE8JTMCT57YLGNVOVOlXDsYQqR1AdI3SrXsoCFQsWQNz8rKehab3hQvKBI/g9DbeB+1srJiEBQomw++XZXG5JK+4YHR9I6ODn99YYiC3RV2BkzF5uZmw2q1noeIGiUMigQNVEulvAaUAh3ShBzy3SFkWqEJC4sbQW+x1O9F4pGcZijKysrCbTbbJXS+Gq0NO7X7gE/i7da+d8nYLt8oSCuInGV3VZVzt4x6zCUsrxUVFZGo8efsdvs1bHJHPKGMKThgpB3pewOkP5d5ymvq7uCSu8Ip6TnmQBK7lleGo6GhwZyQkHAqPj7+Egh9CdF9j+JSggpXgk1+bGpqugpPpYHoGcw7npOTkwIS97RwOMRz9Nhd3hV2I7FniSUJTqytrQ2FoRMw9Irlv783gNdSU1Ofy8zMjOrq6mIRM9LT0yOQyp+IUadGoFu0QhIvB5LYs8SShMoOhsXtdhutra1+dHd3+wnSML/zek6xoXC9CEN/a2np0kh4dU+oq9ue+amHhALi7wM2HoIG+U5vzxQwOmgkRFcixuxiXCdBgd5RVzeW6gPd25RHdOhKVgR4QUFoziGN/5Ba4tBIuDQSf0Ivz/MOeuhfMvsRlAwKx/0xESRuC4lAT/CuOQx8y/lHQkAnwRJcXl5+LDk5OQmnvC1Xe52EXdK1mi37SAmocPBkJIFwJIJEvZBwiHF6wAcdlHDukREIJEFPSFVNQjhuyak9ShtIbxtvUkdKQL+sKBLQRAT6ixVp+xOI1CBLbqLzXsFvi5NH7oFAIrzQCIlQFK83gfeBC8BJ3heYiv8CA3isy4IxUaYAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFdklEQVR42sVW+VNTVxS+f4Od9oeW0RmlU8dOcRx3BEHbqiio3dtfamds+0N1bGe62emirYpSLRYDguAWJQihLZBAEkgKgbCHgIBAXbBTtgSykhAQEL/ecyWtwwMHx9DemS/vvXvv+c73zj3n5DEAjHBodJz9MD7BvuP3KVbb0xqV1p6lzENzS9u7Y3zOVWNittXPMmvMWmaNjZgeW8OZY91i1pSbzSqcg6y01Lj7V7UOap3Bma9WhyiKtEyh0bGsQg0L+P3n5talDNZ5LpWZCwqYqqYxJk9TggK1Bkpza7pWrWNdsZHM/uKymZ1Pgvb07ohiel0Jy7VcO1ug0iCfc+WbW7fUa0vYrUw5u6G8IhXglR1l/qR45tu/l9WeTo5XGqvxS3k1tPmF+t6Y8MXOVYui+3ZEb+ROHoq+HVEb3WtCo23bIhZrCwoNuZyHuKpTU474v/2M+dOSmDdDJhVgzUxn1oQDcd7w59C5+00oqxqgsLTBnHAIQ8vnoy9uPbiDWYH2kk1dwmFkWdqRU2nG9V2vw8e5rScOx/ZnX5YK6Dvw6Z6+VzYMepY8hT8++ZALMONKfQuqkxLhWf88rNvCZy2A54KwqTp1UnCQgPZ9H8Cz5ElYX93gsR38/COpgO3r5bata+FYHYrKve8jp7EDuW23USRLQveKhXDERc5agCMuAt0rF6JQdkpw5DS1o3LPbsFti1nLIxQplx7BljVyO3fSExUG/YYVyFMVIa/lOvLfewcdyxbAvTNq1gJobzu3Ue16G3nNnCNfDUP0cvRELwX5IF9SAbERchtftO+MRsOKUKjXhUG9JRJlSxegm4fUvn32OUB7ycYYNh/qzRFQh4cJTuK23Y+kVED/1nA5BxycwMZxbWUoml4IQdemVXBujwStPQpc3KZr8yo0hYWglXMRJ3FPrksF2F57Sc4BK4f9jZfhfmuzgPPNTWLO9oggG7IN8BDnAzxSAaWL5sk58C+emMS8x8S0PFIBjQf3yznwH0EqwAfIOTAThqZgpjXf7CAV4PAMyjkwFXa3R1xHx+9i4h4wzn/o6r8zKtb6XW4MjdwBnxLw+ofF3HRcD2D2AlxeH5yDXpgsjdBWmFBcVY3S2jr0DTiEKN/wCFpu3ERReQUM1TW4+VcXfFxQ0AQMDvmFiPQcJb5PTkHi+Qs4cEqGo2fS0dndCxrFlVX4OvEkvvjxOCrMDSISQRMQgM3pgtXhFPd0lV3OxOmsKyICdByd3T04xkVVNFhw994cCPDwSIyMjQtyGhVms4hIt61fPA/wcz+WnjF3Alw8DygKvXYHbvf0IlmhgDy/QCQdCeviQuZUAL04kX/1UyK++TkJB2XJ+JMLIWd0DHMugEqNMrysrh6GmlocP3ceOlMlhkfHRA7MuYCByXoPDD0vucOnU2HlR0IOe/oHRBJSuU4EswoCjYjelOqeGhENpVaHhIyzounQcPNSjU87g/qWVvF83zYIAty+IdGI1GVGXCpQ4Te9ARnKXHx5/AQqLU3CWUNbu5g7kpomypOaFdmQ7WMLoPKjClCo1Dh54SJSMhVIy85BbXMLRnhUKNzUGU+cPYdsjRYpiixc4tVBzcsz9AgCXF7vQ3OAOiJlO139PBfG7k4IJ5Qb9Ka0RiUZ2PPQkua+JAKcfJIvzGhEZxwAOZ7aIzwPrLunrE/z3zLN90Brh9zu8vCmMsY3DIozDCYcHJTIlNTNHdelAorLTPG1lmbYuUrfCA/nsB+D/uDA679/fBSBWstVaPTGIxIBXX22EH151UVdqQn1V1sF6ppagoIAX6mpBhpD+YUSY9Uz0s/ygQFWXtPA1MXGjzUGo4Fv1HCoggRNkcGoLykz7fvdVMP0HBIB/xf+Bi8VajXQRja5AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,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\"","module.exports = \"data:image/png;base64,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\"","module.exports = \"data:image/png;base64,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\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAC4jAAAuIwF4pT92AAAFfklEQVR42qWXWWicVRiG/39mUim4NRq88MZWXIpLe+FS6lYKtZsW0UrRUmyllUIXpQiN3hXBC1sxdyom6q2lVRGhUqvFClURUVFUsu+ZmD2TTDKTycTn/fudcPzNJJMaeDOTnHO+7z3ffoLm5uagFFpaWpJ8LmloaAgaGxuD3t7epePj49unpqbeLhQKn4EvwQVwjv+dYm1fOp2u0t76+vqgqampAhmp+XTMqxwB0XcUr8pmsydQ8jPK0oYe0G3f+8AgGGDPn+x9t7+//8HW1taIODKSiyWQ0MGurq4bEKbbjoEZUATTYApMgglDrnDpp2j7hPzk5ORJyN9qJBLlEoiUDw4ObkNIhydQ6JHQ4eHhF1jfgLlXg7v5vn5oaGj3xMTE++xpjZ0ZyWQy+7Fo4Cw6H4GENnLgcExIu/6HRa7XugjOBcno7Oy8EjI7ccVvOstnJIP4OG4kwlIEopuj6JAdlElnuFUtiq/Tmt1ApkwiTJ+hIWF+TmiP9nZ0dChgj/my+LtGJPyYcAHnzL5VfuRAXgfGxsZe1rrWLCOCcuAHMO7agazs1CUWM7KkyYtiwm0OdUuL7KJTLiFAt/VvWQ4SdiYpZbjkCbOEAjhHYN7hLiWWS8QEU7/jfM73Ov3PlAfOrEZoQbi9Zu6UvnOhaic/n89/3dbWFq1FBQNGd7IwbinWiTWuRkjolLe3t1+BKZ8nJV8FRyH4ylxgrVp7RkdHDxIDyxwJXQQZARb4wSxcxCpbpTtiy6E3HTuYHnI+crGB8v2xrFgQEHrLBa0XYxtdvcjlcp9HMcDtr4LZr8Ysze2v8fI11MGBgYFtZqFiGcq1J0+wvWRyQnNnILOj6yfb8zc/VQGp8RR/9Mr8sDppfgtjUR1QcFZBdjN4FGwsAa1tAverDMcKT5Si6HvNKmmGorZbjGrFRqwx9d65Uk4H5a/FIF71nBv6+voesdKt/nEq4NcX1lByKq9+jvoW4OB9NJjHwCawuQS0tgU8jLkTMRKRO3t6em5ReVZ1Bd+KwFfW1bKq7UYgjPWF7ZYhZQchMVDtVc7AlXB0VJpy9YwzInDeCpAI3OUT8LJg72KzgMx6ww9Cj8C1rLeBFkfgrOeC9XEXWPSmRkZGdpCih8EBcLAEDqiXsHePmlI8DswFy9E1rHoDLioIP+JLvyKT4rCrVBBqKvqfQRjaVLXGglA6zyot9lhEFl0Jjqeh0N3dXcXhleA2cHsJaG0lZr7R0vlfWaCeg4WOWhqOkYYvilEVVvjLikMbplsaL0RE9UPms1FDpgRGLcLTuOHZeCFSbUDXBQvoIQrRTa4U17rgIeCe8eIgCkKEHVlsEHK792KlOOQi95j5p2lI56NSLH+x8IAKkRZg+AeNpILDUUuVEKxSiateh+iHoE6jVwnUsf4BqMGyy72OGHVVKu0ZV8656K6oGWl0lmlYPO2l0DFzQcqZ73LghhNL5Z2uV3DJX+iOumRKG1IWnTcrMGxoEMOn3UjtDSTlwO1VO0+Zhe/V9OxGM9J9nbk5FZ8H99nkop1Z0vJJu00YL88LjGSz8YPyNVZpC2bd407nf4ZS+Qlfn/AHSU0ymCv0htKkd9PAS9toZHMTkWSprugizu8E3seSpfiacyy3m4pEjdfbReY7zLbFxqiSY7lLNW69VgOHnXXKT2tSduRKPkwcCQ0U9uqZTS2E/ah+Tmdcp64GKsEysIIYWqsGhKJvrNDMntObQCNZXPmCTzOErkbg2di0U7CUVeHpstdTxpRO+1OTCDNNbXCZFFc+7+PUjdQyO758HJN+apNTxh6iae9xOmBVUBYbhvQ5sug5pdrlPk79B0aFUsleyVUUG/WOT8D39jS/CH7XJ2tH2LNCe60hJRd6nv8Dwj5T3q96iTAAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,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\"","// https://martin.ankerl.com/2009/12/09/how-to-create-random-colors-programmatically/\r\n\r\nconst golden_ratio_conjugate=0.618033988749895;\r\n\r\nexport class ColorPicker {\r\n    constructor() {\r\n        this.names={};\r\n        this.current_h=Math.random();\r\n    }\r\n\r\n    get(name) {\r\n        name=name.toLowerCase();\r\n        if(name==='洞主')\r\n            return ['hsl(0,0%,97%)','hsl(0,0%,16%)'];\r\n\r\n        if(!this.names[name]) {\r\n            this.current_h+=golden_ratio_conjugate;\r\n            this.current_h%=1;\r\n            this.names[name]=[\r\n                `hsl(${this.current_h*360}, 50%, 90%)`,\r\n                `hsl(${this.current_h*360}, 60%, 20%)`,\r\n            ];\r\n        }\r\n        return this.names[name];\r\n    }\r\n}","// regexp should match the WHOLE segmented part\r\nexport const PID_RE=/(^|[^\\d\\u20e3\\ufe0e\\ufe0f])([2-9]\\d{4,5}|1\\d{4,6})(?![\\d\\u20e3\\ufe0e\\ufe0f])/g;\r\nexport const URL_PID_RE=/((?:https?:\\/\\/)?qkuhelper\\.qku\\.edu\\.teyvat\\/hole\\/?#(?:#|%23)([2-9]\\d{4,5}|1\\d{4,6}))(?!\\d|\\u20e3|\\ufe0e|\\ufe0f)/g;\r\nexport const NICKNAME_RE=/(^|[^A-Za-z])((?:(?:Angry|Baby|Crazy|Diligent|Excited|Fat|Greedy|Hungry|Interesting|Jolly|Kind|Little|Magic|Naïve|Old|Powerful|Quiet|Rich|Superman|THU|Undefined|Valuable|Wifeless|Xiangbuchulai|Young|Zombie)\\s)?(?:Alice|Bob|Carol|Dave|Eve|Francis|Grace|Hans|Isabella|Jason|Kate|Louis|Margaret|Nathan|Olivia|Paul|Queen|Richard|Susan|Thomas|Uma|Vivian|Winnie|Xander|Yasmine|Zach)|You Win(?: \\d+)?|洞主)(?![A-Za-z])/gi;\r\nexport const URL_RE=/(^|[^.@a-zA-Z0-9_])((?:https?:\\/\\/)?(?:(?:[\\w-]+\\.)+[a-zA-Z]{2,3}|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})(?::\\d{1,5})?(?:\\/[\\w~!@#$%^&*()\\-_=+[\\]{};:,./?|]*)?)(?![a-zA-Z0-9])/gi;\r\n\r\nexport function split_text(txt,rules) {\r\n    // rules: [['name',/regex/],...]\r\n    // return: [['name','part'],[null,'part'],...]\r\n\r\n    txt=[[null,txt]];\r\n    rules.forEach((rule)=>{\r\n        let [name,regex]=rule;\r\n        txt=[].concat.apply([],txt.map((part)=>{\r\n            let [rule,content]=part;\r\n            if(rule) // already tagged by previous rules\r\n                return [part];\r\n            else {\r\n                return content\r\n                    .split(regex)\r\n                    .map((seg)=>(\r\n                        regex.test(seg) ? [name,seg] : [null,seg]\r\n                    ))\r\n                    .filter(([name,seg])=>(\r\n                        name!==null || seg\r\n                    ));\r\n            }\r\n        }));\r\n    });\r\n    return txt;\r\n}\r\n","const HOLE_CACHE_DB_NAME='hole_cache_db';\r\nconst CACHE_DB_VER=1;\r\nconst MAINTENANCE_STEP=150;\r\nconst MAINTENANCE_COUNT=1000;\r\n\r\nconst ENC_KEY=42;\r\n\r\nclass Cache {\r\n    constructor() {\r\n        this.db=null;\r\n        this.added_items_since_maintenance=0;\r\n        this.encrypt=this.encrypt.bind(this);\r\n        this.decrypt=this.decrypt.bind(this);\r\n        const open_req=indexedDB.open(HOLE_CACHE_DB_NAME,CACHE_DB_VER);\r\n        open_req.onerror=console.error.bind(console);\r\n        open_req.onupgradeneeded=(event)=>{\r\n            console.log('comment cache db upgrade');\r\n            const db=event.target.result;\r\n            const store=db.createObjectStore('comment',{\r\n                keyPath: 'pid',\r\n            });\r\n            store.createIndex('last_access','last_access',{unique: false});\r\n        };\r\n        open_req.onsuccess=(event)=>{\r\n            console.log('comment cache db loaded');\r\n            this.db=event.target.result;\r\n            setTimeout(this.maintenance.bind(this),1);\r\n        };\r\n    }\r\n\r\n    // use window.hole_cache.encrypt() only after cache is loaded!\r\n    encrypt(pid,data) {\r\n        let s=JSON.stringify(data);\r\n        let o='';\r\n        for(let i=0,key=(ENC_KEY^pid)%128;i<s.length;i++) {\r\n            let c=s.charCodeAt(i);\r\n            let new_key=(key^(c/2))%128;\r\n            o+=String.fromCharCode(key^s.charCodeAt(i));\r\n            key=new_key;\r\n        }\r\n        return o;\r\n    }\r\n\r\n    // use window.hole_cache.decrypt() only after cache is loaded!\r\n    decrypt(pid,s) {\r\n        let o='';\r\n        if(typeof(s)!==typeof('str'))\r\n            return null;\r\n\r\n        for(let i=0,key=(ENC_KEY^pid)%128;i<s.length;i++) {\r\n            let c=key^s.charCodeAt(i);\r\n            o+=String.fromCharCode(c);\r\n            key=(key^(c/2))%128;\r\n        }\r\n\r\n        try {\r\n            return JSON.parse(o);\r\n        } catch(e) {\r\n            console.error('decrypt failed');\r\n            console.trace(e);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    get(pid,target_version) {\r\n        pid=parseInt(pid);\r\n        return new Promise((resolve,reject)=>{\r\n            if(!this.db)\r\n                return resolve(null);\r\n            let get_req,store;\r\n            try {\r\n                const tx=this.db.transaction(['comment'],'readwrite');\r\n                store=tx.objectStore('comment');\r\n                get_req=store.get(pid);\r\n            } catch(e) { // ios sometimes fail at here, just ignore it\r\n                console.error(e);\r\n                resolve(null);\r\n            }\r\n            get_req.onsuccess=()=>{\r\n                let res=get_req.result;\r\n                if(!res || !res.data_str)  {\r\n                    //console.log('comment cache miss '+pid);\r\n                    resolve(null);\r\n                } else if(target_version===res.version) { // hit\r\n                    console.log('comment cache hit',pid);\r\n                    res.last_access=(+new Date());\r\n                    store.put(res);\r\n                    let data=this.decrypt(pid,res.data_str);\r\n                    resolve(data); // obj or null\r\n                } else { // expired\r\n                    console.log('comment cache expired',pid,': ver',res.version,'target',target_version);\r\n                    store.delete(pid);\r\n                    resolve(null);\r\n                }\r\n            };\r\n            get_req.onerror=(e)=>{\r\n                console.warn('comment cache indexeddb open failed');\r\n                console.error(e);\r\n                resolve(null);\r\n            };\r\n        });\r\n    }\r\n\r\n    put(pid,target_version,data) {\r\n        pid=parseInt(pid);\r\n        return new Promise((resolve,reject)=>{\r\n            if(!this.db)\r\n                return resolve();\r\n            try {\r\n                const tx=this.db.transaction(['comment'],'readwrite');\r\n                const store=tx.objectStore('comment');\r\n                store.put({\r\n                    pid: pid,\r\n                    version: target_version,\r\n                    data_str: this.encrypt(pid,data),\r\n                    last_access: +new Date(),\r\n                });\r\n                if(++this.added_items_since_maintenance===MAINTENANCE_STEP)\r\n                    setTimeout(this.maintenance.bind(this),1);\r\n            } catch(e) {\r\n                console.error(e);\r\n                return resolve();\r\n            }\r\n        });\r\n    }\r\n\r\n    delete(pid) {\r\n        pid=parseInt(pid);\r\n        return new Promise((resolve,reject)=>{\r\n            if(!this.db)\r\n                return resolve();\r\n            let req;\r\n            try {\r\n                const tx=this.db.transaction(['comment'],'readwrite');\r\n                const store=tx.objectStore('comment');\r\n                req=store.delete(pid);\r\n            } catch(e) {\r\n                console.error(e);\r\n                return resolve();\r\n            }\r\n            //console.log('comment cache delete',pid);\r\n            req.onerror=()=>{\r\n                console.warn('comment cache delete failed ',pid);\r\n                return resolve();\r\n            };\r\n            req.onsuccess=()=>resolve();\r\n        });\r\n    }\r\n\r\n    maintenance() {\r\n        if(!this.db)\r\n            return;\r\n        const tx=this.db.transaction(['comment'],'readwrite');\r\n        const store=tx.objectStore('comment');\r\n        let count_req=store.count();\r\n        count_req.onsuccess=()=>{\r\n            let count=count_req.result;\r\n            if(count>MAINTENANCE_COUNT) {\r\n                console.log('comment cache db maintenance',count);\r\n                store.index('last_access').openKeyCursor().onsuccess=(e)=>{\r\n                    let cur=e.target.result;\r\n                    if(cur) {\r\n                        //console.log('maintenance: delete',cur);\r\n                        store.delete(cur.primaryKey);\r\n                        if(--count>MAINTENANCE_COUNT)\r\n                            cur.continue();\r\n                    }\r\n                };\r\n            } else {\r\n                console.log('comment cache db no need to maintenance',count);\r\n            }\r\n            this.added_items_since_maintenance=0;\r\n        };\r\n        count_req.onerror=console.error.bind(console);\r\n    }\r\n\r\n    clear() {\r\n        if(!this.db)\r\n            return;\r\n        try {\r\n            indexedDB.deleteDatabase(HOLE_CACHE_DB_NAME);\r\n            console.log('delete comment cache db');\r\n        } catch(e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\nexport function cache() {\r\n    if(!window.hole_cache)\r\n        window.hole_cache=new Cache();\r\n    return window.hole_cache;\r\n}","import {get_json, API_VERSION_PARAM} from './infrastructure/functions';\r\nimport {QKUHELPER_ROOT} from './infrastructure/const';\r\nimport {API_BASE} from './Common';\r\nimport {cache} from './cache';\r\n\r\nexport {QKUHELPER_ROOT, API_VERSION_PARAM};\r\n\r\nexport function token_param(token) {\r\n    return API_VERSION_PARAM()+(token ? ('&user_token='+token) : '');\r\n}\r\n\r\nexport {get_json};\r\n\r\nconst SEARCH_PAGESIZE=50;\r\n\r\nexport const API={\r\n    load_replies: (pid,token,color_picker,cache_version)=>{\r\n        pid=parseInt(pid);\r\n        return fetch(\r\n            API_BASE+'/api.php?action=getcomment'+\r\n            '&pid='+pid+\r\n            token_param(token)\r\n        )\r\n            .then(get_json)\r\n            .then((json)=>{\r\n                if(json.code!==0) {\r\n                    if(json.msg) throw new Error(json.msg);\r\n                    else throw new Error(JSON.stringify(json));\r\n                }\r\n                if(json.captcha)\r\n                    throw 'CAPTCHA';\r\n\r\n                cache().delete(pid).then(()=>{\r\n                    cache().put(pid,cache_version,json);\r\n                });\r\n\r\n                // also change load_replies_with_cache!\r\n                json.data=json.data\r\n                    .sort((a,b)=>{\r\n                        return parseInt(a.cid,10)-parseInt(b.cid,10);\r\n                    })\r\n                    .map((info)=>{\r\n                        info._display_color=color_picker.get(info.name);\r\n                        info.variant={};\r\n                        return info;\r\n                    });\r\n\r\n                return json;\r\n            });\r\n    },\r\n\r\n    load_replies_with_cache: (pid,token,color_picker,cache_version)=> {\r\n        pid=parseInt(pid);\r\n        return cache().get(pid,cache_version)\r\n            .then((json)=>{\r\n                if(json) {\r\n                    // also change load_replies!\r\n                    json.data=json.data\r\n                        .sort((a,b)=>{\r\n                            return parseInt(a.cid,10)-parseInt(b.cid,10);\r\n                        })\r\n                        .map((info)=>{\r\n                            info._display_color=color_picker.get(info.name);\r\n                            info.variant={};\r\n                            return info;\r\n                        });\r\n\r\n                    return json;\r\n                }\r\n                else\r\n                    return API.load_replies(pid,token,color_picker,cache_version);\r\n            });\r\n    },\r\n\r\n    set_attention: (pid,attention,token)=>{\r\n        let data=new URLSearchParams();\r\n        data.append('user_token',token);\r\n        data.append('pid',pid);\r\n        data.append('switch',attention ? '1' : '0');\r\n        return fetch(API_BASE+'/api.php?action=attention'+token_param(token), {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/x-www-form-urlencoded',\r\n            },\r\n            body: data,\r\n        })\r\n            .then(get_json)\r\n            .then((json)=>{\r\n                cache().delete(pid);\r\n                if(json.code!==0) {\r\n                    if(json.msg && json.msg==='已经关注过了') {}\r\n                    else {\r\n                        if(json.msg) alert(json.msg);\r\n                        throw new Error(JSON.stringify(json));\r\n                    }\r\n                }\r\n                return json;\r\n            });\r\n    },\r\n\r\n    report: (pid,reason,token)=>{\r\n        let data=new URLSearchParams();\r\n        data.append('user_token',token);\r\n        data.append('pid',pid);\r\n        data.append('reason',reason);\r\n        return fetch(API_BASE+'/api.php?action=report'+token_param(token), {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/x-www-form-urlencoded',\r\n            },\r\n            body: data,\r\n        })\r\n            .then(get_json)\r\n            .then((json)=>{\r\n                if(json.code!==0) {\r\n                    if(json.msg) alert(json.msg);\r\n                    throw new Error(JSON.stringify(json));\r\n                }\r\n                return json;\r\n            });\r\n    },\r\n\r\n    get_list: (page,token)=>{\r\n        return fetch(\r\n            API_BASE+'/api.php?action=getlist'+\r\n            '&p='+page+\r\n            token_param(token)\r\n        )\r\n            .then(get_json)\r\n            .then((json)=>{\r\n                if(json.code!==0)\r\n                    throw new Error(JSON.stringify(json));\r\n                return json;\r\n            });\r\n    },\r\n\r\n    get_search: (page,keyword,token)=>{\r\n        return fetch(\r\n            API_BASE+'/api.php?action=search'+\r\n            '&pagesize='+SEARCH_PAGESIZE+\r\n            '&page='+page+\r\n            '&keywords='+encodeURIComponent(keyword)+\r\n            token_param(token)\r\n        )\r\n            .then(get_json)\r\n            .then((json)=>{\r\n                if(json.code!==0) {\r\n                    if(json.msg) throw new Error(json.msg);\r\n                    throw new Error(JSON.stringify(json));\r\n                }\r\n                return json;\r\n            });\r\n    },\r\n\r\n    get_single: (pid,token)=>{\r\n        return fetch(\r\n            API_BASE+'/api.php?action=getone'+\r\n            '&pid='+pid+\r\n            token_param(token)\r\n        )\r\n            .then(get_json)\r\n            .then((json)=>{\r\n                if(json.code!==0) {\r\n                    if(json.msg) throw new Error(json.msg);\r\n                    else throw new Error(JSON.stringify(json));\r\n                }\r\n                return json;\r\n            });\r\n    },\r\n\r\n    get_attention: (token)=>{\r\n        return fetch(\r\n            API_BASE+'/api.php?action=getattention'+\r\n            token_param(token)\r\n        )\r\n            .then(get_json)\r\n            .then((json)=>{\r\n                if(json.code!==0) {\r\n                    if(json.msg) throw new Error(json.msg);\r\n                    throw new Error(JSON.stringify(json));\r\n                }\r\n                return json;\r\n            });\r\n    },\r\n};","import React, {Component, PureComponent} from 'react';\r\nimport {format_time,Time,TitleLine} from './infrastructure/widgets';\r\nimport {QKUHELPER_ROOT} from './flows_api';\r\n\r\nimport './Common.css';\r\n\r\nexport {format_time,Time,TitleLine};\r\n\r\nexport const API_BASE=QKUHELPER_ROOT+'services/qkuhole';\r\n\r\n// https://stackoverflow.com/questions/3446170/escape-string-for-use-in-javascript-regex\r\nfunction escape_regex(string) {\r\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\r\n}\r\n\r\nexport function build_highlight_re(txt,split,option='g') {\r\n    return txt ? new RegExp(`(${txt.split(split).filter((x)=>!!x).map(escape_regex).join('|')})`,option) : /^$/g;\r\n}\r\n\r\nexport function ColoredSpan(props) {\r\n    return (\r\n        <span className=\"colored-span\" style={{\r\n            '--coloredspan-bgcolor-light': props.colors[0],\r\n            '--coloredspan-bgcolor-dark': props.colors[1],\r\n        }}>{props.children}</span>\r\n    )\r\n}\r\n\r\nexport class HighlightedText extends PureComponent {\r\n    render() {\r\n        function normalize_url(url) {\r\n            return /^https?:\\/\\//.test(url) ? url : 'http://'+url;\r\n        }\r\n        return (\r\n            <pre>\r\n                {this.props.parts.map((part,idx)=>{\r\n                    let [rule,p]=part;\r\n                    return (\r\n                        <span key={idx}>{\r\n                            rule==='url_pid' ? <span className=\"url-pid-link\" title={p}>/hole/##</span> :\r\n                            rule==='url' ? <a href={normalize_url(p)} target=\"_blank\" rel=\"noopener\">{p}</a> :\r\n                            rule==='pid' ? <a href={'##'+p} onClick={(e)=>{e.preventDefault(); this.props.show_pid(p);}}>{p}</a> :\r\n                            rule==='nickname' ? <ColoredSpan colors={this.props.color_picker.get(p)}>{p}</ColoredSpan> :\r\n                            rule==='search' ? <span className=\"search-query-highlight\">{p}</span> :\r\n                            p\r\n                        }</span>\r\n                    );\r\n                })}\r\n            </pre>\r\n        )\r\n    }\r\n}\r\n\r\nwindow.TEXTAREA_BACKUP={};\r\n\r\nexport class SafeTextarea extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            text: '',\r\n        };\r\n        this.on_change_bound=this.on_change.bind(this);\r\n        this.on_keydown_bound=this.on_keydown.bind(this);\r\n        this.clear=this.clear.bind(this);\r\n        this.area_ref=React.createRef();\r\n        this.change_callback=props.on_change||(()=>{});\r\n        this.submit_callback=props.on_submit||(()=>{});\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.setState({\r\n            text: window.TEXTAREA_BACKUP[this.props.id]||''\r\n        },()=>{\r\n            this.change_callback(this.state.text);\r\n        });\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        window.TEXTAREA_BACKUP[this.props.id]=this.state.text;\r\n        this.change_callback(this.state.text);\r\n    }\r\n\r\n    on_change(event) {\r\n        this.setState({\r\n            text: event.target.value,\r\n        });\r\n        this.change_callback(event.target.value);\r\n    }\r\n    on_keydown(event) {\r\n        if(event.key==='Enter' && event.ctrlKey && !event.altKey) {\r\n            event.preventDefault();\r\n            this.submit_callback();\r\n        }\r\n    }\r\n\r\n    clear() {\r\n        this.setState({\r\n            text: '',\r\n        });\r\n    }\r\n    set(text) {\r\n        this.change_callback(text);\r\n        this.setState({\r\n            text: text,\r\n        });\r\n    }\r\n    get() {\r\n        return this.state.text;\r\n    }\r\n    focus() {\r\n        this.area_ref.current.focus();\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <textarea ref={this.area_ref} onChange={this.on_change_bound} value={this.state.text} onKeyDown={this.on_keydown_bound} />\r\n        )\r\n    }\r\n}\r\n\r\nlet pwa_prompt_event=null;\r\nwindow.addEventListener('beforeinstallprompt', (e) => {\r\n    console.log('pwa: received before install prompt');\r\n    pwa_prompt_event=e;\r\n});\r\n\r\nexport function PromotionBar(props) {\r\n    let is_ios=/iPhone|iPad|iPod/i.test(window.navigator.userAgent);\r\n    let is_installed=(window.matchMedia('(display-mode: standalone)').matches) || (window.navigator.standalone);\r\n\r\n    if(is_installed)\r\n        return null;\r\n\r\n    if(is_ios)\r\n        // noinspection JSConstructorReturnsPrimitive\r\n        return !navigator.standalone ? (\r\n            <div className=\"box promotion-bar\">\r\n                <span className=\"icon icon-about\" />&nbsp;\r\n                用 Safari 把树洞 <b>添加到主屏幕</b> 更好用\r\n            </div>\r\n        ) : null;\r\n    else\r\n        // noinspection JSConstructorReturnsPrimitive\r\n        return pwa_prompt_event ? (\r\n            <div className=\"box promotion-bar\">\r\n                <span className=\"icon icon-about\" />&nbsp;\r\n                把网页版树洞 <b><a onClick={()=>{\r\n                    if(pwa_prompt_event)\r\n                        pwa_prompt_event.prompt();\r\n            }}>安装到桌面</a></b> 更好用\r\n            </div>\r\n        ) : null;\r\n}\r\n\r\nexport class ClickHandler extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            moved: true,\r\n            init_y: 0,\r\n            init_x: 0,\r\n        };\r\n        this.on_begin_bound=this.on_begin.bind(this);\r\n        this.on_move_bound=this.on_move.bind(this);\r\n        this.on_end_bound=this.on_end.bind(this);\r\n\r\n        this.MOVE_THRESHOLD=3;\r\n        this.last_fire=0;\r\n    }\r\n\r\n    on_begin(e) {\r\n        //console.log('click',(e.touches?e.touches[0]:e).screenY,(e.touches?e.touches[0]:e).screenX);\r\n        this.setState({\r\n            moved: false,\r\n            init_y: (e.touches?e.touches[0]:e).screenY,\r\n            init_x: (e.touches?e.touches[0]:e).screenX,\r\n        });\r\n    }\r\n    on_move(e) {\r\n        if(!this.state.moved) {\r\n            let mvmt=Math.abs((e.touches?e.touches[0]:e).screenY-this.state.init_y)+Math.abs((e.touches?e.touches[0]:e).screenX-this.state.init_x);\r\n            //console.log('move',mvmt);\r\n            if(mvmt>this.MOVE_THRESHOLD)\r\n                this.setState({\r\n                    moved: true,\r\n                });\r\n        }\r\n    }\r\n    on_end(event) {\r\n        //console.log('end');\r\n        if(!this.state.moved)\r\n            this.do_callback(event);\r\n        this.setState({\r\n            moved: true,\r\n        });\r\n    }\r\n\r\n    do_callback(event) {\r\n        if(this.last_fire+100>+new Date()) return;\r\n        this.last_fire=+new Date();\r\n        this.props.callback(event);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div onTouchStart={this.on_begin_bound} onMouseDown={this.on_begin_bound}\r\n                 onTouchMove={this.on_move_bound} onMouseMove={this.on_move_bound}\r\n                 onClick={this.on_end_bound} >\r\n                {this.props.children}\r\n            </div>\r\n        )\r\n    }\r\n}","export function on(el, eventName, callback, opts) {\r\n  opts = opts || false;\r\n  if (el.addEventListener) {\r\n    el.addEventListener(eventName, callback, opts);\r\n  } else if (el.attachEvent) {\r\n    el.attachEvent(`on${eventName}`, (e) => {\r\n      callback.call(el, e || window.event);\r\n    });\r\n  }\r\n}\r\n\r\nexport function off(el, eventName, callback, opts) {\r\n  opts = opts || false;\r\n  if (el.removeEventListener) {\r\n    el.removeEventListener(eventName, callback, opts);\r\n  } else if (el.detachEvent) {\r\n    el.detachEvent(`on${eventName}`, callback);\r\n  }\r\n}\r\n","/**\r\n * @fileOverview Find scroll parent\r\n */\r\n\r\nexport default (node) => {\r\n  if (!(node instanceof HTMLElement)) {\r\n    return document.documentElement;\r\n  }\r\n\r\n  const excludeStaticParent = node.style.position === 'absolute';\r\n  const overflowRegex = /(scroll|auto)/;\r\n  let parent = node;\r\n\r\n  while (parent) {\r\n    if (!parent.parentNode) {\r\n      return node.ownerDocument || document.documentElement;\r\n    }\r\n\r\n    const style = window.getComputedStyle(parent);\r\n    const position = style.position;\r\n    const overflow = style.overflow;\r\n    const overflowX = style['overflow-x'];\r\n    const overflowY = style['overflow-y'];\r\n\r\n    if (position === 'static' && excludeStaticParent) {\r\n      parent = parent.parentNode;\r\n      continue;\r\n    }\r\n\r\n    if (overflowRegex.test(overflow) && overflowRegex.test(overflowX) && overflowRegex.test(overflowY)) {\r\n      return parent;\r\n    }\r\n\r\n    parent = parent.parentNode;\r\n  }\r\n\r\n  return node.ownerDocument || node.documentElement || document.documentElement;\r\n};\r\n","/**\n * react-lazyload\n */\nimport React, { Component, PureComponent } from 'react';\nimport ReactDom from 'react-dom';\nimport PropTypes from 'prop-types';\nimport { on, off } from './utils/event';\nimport scrollParent from './utils/scrollParent';\nimport debounce from './utils/debounce';\nimport throttle from './utils/throttle';\n\nconst defaultBoundingClientRect = { top: 0, right: 0, bottom: 0, left: 0, width: 0, height: 0 };\nconst LISTEN_FLAG = 'data-lazyload-listened';\nconst listeners = [];\nlet pending = [];\n\n// try to handle passive events\nlet passiveEventSupported = false;\ntry {\n  const opts = Object.defineProperty({}, 'passive', {\n    get() {\n      passiveEventSupported = true;\n    }\n  });\n  window.addEventListener('test', null, opts);\n}\ncatch (e) { }\n// if they are supported, setup the optional params\n// IMPORTANT: FALSE doubles as the default CAPTURE value!\nconst passiveEvent = passiveEventSupported ? { capture: false, passive: true } : false;\n\n\n/**\n * Check if `component` is visible in overflow container `parent`\n * @param  {node} component React component\n * @param  {node} parent    component's scroll parent\n * @return {bool}\n */\nconst checkOverflowVisible = function checkOverflowVisible(component, parent) {\n  const node = ReactDom.findDOMNode(component);\n\n  let parentTop;\n  let parentHeight;\n\n  try {\n    ({ top: parentTop, height: parentHeight } = parent.getBoundingClientRect());\n  } catch (e) {\n    ({ top: parentTop, height: parentHeight } = defaultBoundingClientRect);\n  }\n\n  const windowInnerHeight = window.innerHeight || document.documentElement.clientHeight;\n\n  // calculate top and height of the intersection of the element's scrollParent and viewport\n  const intersectionTop = Math.max(parentTop, 0); // intersection's top relative to viewport\n  const intersectionHeight = Math.min(windowInnerHeight, parentTop + parentHeight) - intersectionTop; // height\n\n  // check whether the element is visible in the intersection\n  let top;\n  let height;\n\n  try {\n    ({ top, height } = node.getBoundingClientRect());\n  } catch (e) {\n    ({ top, height } = defaultBoundingClientRect);\n  }\n\n  const offsetTop = top - intersectionTop; // element's top relative to intersection\n\n  const offsets = Array.isArray(component.props.offset) ?\n                component.props.offset :\n                [component.props.offset, component.props.offset]; // Be compatible with previous API\n\n  return (offsetTop - offsets[0] <= intersectionHeight) &&\n         (offsetTop + height + offsets[1] >= 0);\n};\n\n/**\n * Check if `component` is visible in document\n * @param  {node} component React component\n * @return {bool}\n */\nconst checkNormalVisible = function checkNormalVisible(component) {\n  const node = ReactDom.findDOMNode(component);\n\n  // If this element is hidden by css rules somehow, it's definitely invisible\n  if (!(node.offsetWidth || node.offsetHeight || node.getClientRects().length)) return false;\n\n  let top;\n  let elementHeight;\n\n  try {\n    ({ top, height: elementHeight } = node.getBoundingClientRect());\n  } catch (e) {\n    ({ top, height: elementHeight } = defaultBoundingClientRect);\n  }\n\n  const windowInnerHeight = window.innerHeight || document.documentElement.clientHeight;\n\n  const offsets = Array.isArray(component.props.offset) ?\n                component.props.offset :\n                [component.props.offset, component.props.offset]; // Be compatible with previous API\n\n  return (top - offsets[0] <= windowInnerHeight) &&\n         (top + elementHeight + offsets[1] >= 0);\n};\n\n\n/**\n * Detect if element is visible in viewport, if so, set `visible` state to true.\n * If `once` prop is provided true, remove component as listener after checkVisible\n *\n * @param  {React} component   React component that respond to scroll and resize\n */\nconst checkVisible = function checkVisible(component) {\n  const node = ReactDom.findDOMNode(component);\n  if (!(node instanceof HTMLElement)) {\n    return;\n  }\n\n  const parent = scrollParent(node);\n  const isOverflow = component.props.overflow &&\n                     parent !== node.ownerDocument &&\n                     parent !== document &&\n                     parent !== document.documentElement;\n  const visible = isOverflow ?\n                  checkOverflowVisible(component, parent) :\n                  checkNormalVisible(component);\n  if (visible) {\n    // Avoid extra render if previously is visible\n    if (!component.state.visible || component.state.hidden) {\n      if (component.props.once) {\n        pending.push(component);\n      }\n\n      //console.log('lazyload 1');\n      component.setState({\n        visible: true,\n        hidden: false,\n      });\n    }\n  } else if (!component.props.once) {\n    if (component.props.unmountIfInvisible) {\n      if(component.visible===true)\n        component.setState({\n          visible: false,\n        });\n    } else if(component.props.hiddenIfInvisible) {\n      if(component.state.hidden===false) {\n        //console.log('lazyload 3');\n        component.setState({\n          hidden: true,\n        });\n      }\n    }\n  }\n};\n\n\nconst purgePending = function purgePending() {\n  pending.forEach((component) => {\n    const index = listeners.indexOf(component);\n    if (index !== -1) {\n      listeners.splice(index, 1);\n    }\n  });\n\n  pending = [];\n};\n\nconst lazyLoadHandler = () => {\n  for (let i = 0; i < listeners.length; ++i) {\n    const listener = listeners[i];\n    checkVisible(listener);\n  }\n  // Remove `once` component in listeners\n  purgePending();\n};\n\n// Depending on component's props\nlet delayType;\nlet finalLazyLoadHandler = null;\n\nconst isString = string => typeof string === 'string';\n\nclass LazyLoad extends PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state={\n      visible: false,\n      hidden: false,\n    };\n  }\n\n  componentDidMount() {\n    // It's unlikely to change delay type on the fly, this is mainly\n    // designed for tests\n    let scrollport = window;\n    const {\n      scrollContainer,\n    } = this.props;\n    if (scrollContainer) {\n      if (isString(scrollContainer)) {\n        scrollport = scrollport.document.querySelector(scrollContainer);\n      }\n    }\n    const needResetFinalLazyLoadHandler = (this.props.debounce !== undefined && delayType === 'throttle')\n      || (delayType === 'debounce' && this.props.debounce === undefined);\n\n    if (needResetFinalLazyLoadHandler) {\n      off(scrollport, 'scroll', finalLazyLoadHandler, passiveEvent);\n      off(window, 'resize', finalLazyLoadHandler, passiveEvent);\n      finalLazyLoadHandler = null;\n    }\n\n    if (!finalLazyLoadHandler) {\n      if (this.props.debounce !== undefined) {\n        finalLazyLoadHandler = debounce(lazyLoadHandler, typeof this.props.debounce === 'number' ?\n                                                         this.props.debounce :\n                                                         300);\n        delayType = 'debounce';\n      } else if (this.props.throttle !== undefined) {\n        finalLazyLoadHandler = throttle(lazyLoadHandler, typeof this.props.throttle === 'number' ?\n                                                         this.props.throttle :\n                                                         300);\n        delayType = 'throttle';\n      } else {\n        finalLazyLoadHandler = lazyLoadHandler;\n      }\n    }\n\n    if (this.props.overflow) {\n      const parent = scrollParent(ReactDom.findDOMNode(this));\n      if (parent && typeof parent.getAttribute === 'function') {\n        const listenerCount = 1 + (+parent.getAttribute(LISTEN_FLAG));\n        if (listenerCount === 1) {\n          parent.addEventListener('scroll', finalLazyLoadHandler, passiveEvent);\n        }\n        parent.setAttribute(LISTEN_FLAG, listenerCount);\n      }\n    } else if (listeners.length === 0 || needResetFinalLazyLoadHandler) {\n      const { scroll, resize } = this.props;\n\n      if (scroll) {\n        on(scrollport, 'scroll', finalLazyLoadHandler, passiveEvent);\n      }\n\n      if (resize) {\n        on(window, 'resize', finalLazyLoadHandler, passiveEvent);\n      }\n    }\n\n    listeners.push(this);\n    checkVisible(this);\n  }\n\n  componentWillUnmount() {\n    if (this.props.overflow) {\n      const parent = scrollParent(ReactDom.findDOMNode(this));\n      if (parent && typeof parent.getAttribute === 'function') {\n        const listenerCount = (+parent.getAttribute(LISTEN_FLAG)) - 1;\n        if (listenerCount === 0) {\n          parent.removeEventListener('scroll', finalLazyLoadHandler, passiveEvent);\n          parent.removeAttribute(LISTEN_FLAG);\n        } else {\n          parent.setAttribute(LISTEN_FLAG, listenerCount);\n        }\n      }\n    }\n\n    const index = listeners.indexOf(this);\n    if (index !== -1) {\n      listeners.splice(index, 1);\n    }\n\n    if (listeners.length === 0 && typeof window !== 'undefined') {\n      off(window, 'resize', finalLazyLoadHandler, passiveEvent);\n      off(window, 'scroll', finalLazyLoadHandler, passiveEvent);\n    }\n  }\n\n  render() {\n    //console.log('lazyload render');\n    if(this.state.visible) {\n      if(this.props.hiddenIfInvisible)\n        return this.state.hidden ?\n            <div style={{visibility: 'hidden'}}>{this.props.children}</div> :\n            <div>{this.props.children}</div>;\n      else\n        return this.props.children;\n    }\n    else\n      return this.props.placeholder ?\n                this.props.placeholder :\n                <div style={{ height: this.props.height }} className=\"lazyload-placeholder\" />;\n  }\n}\n\nLazyLoad.propTypes = {\n  once: PropTypes.bool,\n  height: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  offset: PropTypes.oneOfType([PropTypes.number, PropTypes.arrayOf(PropTypes.number)]),\n  overflow: PropTypes.bool,\n  resize: PropTypes.bool,\n  scroll: PropTypes.bool,\n  children: PropTypes.node,\n  throttle: PropTypes.oneOfType([PropTypes.number, PropTypes.bool]),\n  debounce: PropTypes.oneOfType([PropTypes.number, PropTypes.bool]),\n  placeholder: PropTypes.node,\n  scrollContainer: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),\n  unmountIfInvisible: PropTypes.bool,\n  hiddenIfInvisible: PropTypes.bool,\n};\n\nLazyLoad.defaultProps = {\n  once: false,\n  offset: 0,\n  overflow: false,\n  resize: false,\n  scroll: true,\n  unmountIfInvisible: false,\n  hiddenIfInvisible: false,\n};\n\nconst getDisplayName = WrappedComponent => WrappedComponent.displayName || WrappedComponent.name || 'Component';\n\nconst decorator = (options = {}) => function lazyload(WrappedComponent) {\n  return class LazyLoadDecorated extends Component {\n    constructor() {\n      super();\n      this.displayName = `LazyLoad${getDisplayName(WrappedComponent)}`;\n    }\n\n    render() {\n      return (\n        <LazyLoad {...options}>\n          <WrappedComponent {...this.props} />\n        </LazyLoad>\n      );\n    }\n  };\n};\n\nexport { decorator as lazyload };\nexport default LazyLoad;\nexport { lazyLoadHandler as forceCheck };\n","export default function debounce(func, wait, immediate) {\r\n  let timeout;\r\n  let args;\r\n  let context;\r\n  let timestamp;\r\n  let result;\r\n\r\n  const later = function later() {\r\n    const last = +(new Date()) - timestamp;\r\n\r\n    if (last < wait && last >= 0) {\r\n      timeout = setTimeout(later, wait - last);\r\n    } else {\r\n      timeout = null;\r\n      if (!immediate) {\r\n        result = func.apply(context, args);\r\n        if (!timeout) {\r\n          context = null;\r\n          args = null;\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  return function debounced() {\r\n    context = this;\r\n    args = arguments;\r\n    timestamp = +(new Date());\r\n\r\n    const callNow = immediate && !timeout;\r\n    if (!timeout) {\r\n      timeout = setTimeout(later, wait);\r\n    }\r\n\r\n    if (callNow) {\r\n      result = func.apply(context, args);\r\n      context = null;\r\n      args = null;\r\n    }\r\n\r\n    return result;\r\n  };\r\n}\r\n","/*eslint-disable */\r\nexport default function throttle(fn, threshhold, scope) {\r\n  threshhold || (threshhold = 250);\r\n  var last,\r\n      deferTimer;\r\n  return function () {\r\n    var context = scope || this;\r\n\r\n    var now = +new Date,\r\n        args = arguments;\r\n    if (last && now < last + threshhold) {\r\n      // hold on to it\r\n      clearTimeout(deferTimer);\r\n      deferTimer = setTimeout(function () {\r\n        last = now;\r\n        fn.apply(context, args);\r\n      }, threshhold);\r\n    } else {\r\n      last = now;\r\n      fn.apply(context, args);\r\n    }\r\n  };\r\n}\r\n","import React, {Component} from 'react';\r\nimport load from 'load-script';\r\n\r\nwindow.audio_cache={};\r\n\r\nfunction load_amrnb() {\r\n    return new Promise((resolve,reject)=>{\r\n        if(window.AMR)\r\n            resolve();\r\n        else\r\n            load('static/amr_all.min.js', (err)=>{\r\n                if(err)\r\n                    reject(err);\r\n                else\r\n                    resolve();\r\n            });\r\n    });\r\n}\r\n\r\nexport class AudioWidget extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            url: this.props.src,\r\n            state: 'waiting',\r\n            data: null,\r\n        };\r\n    }\r\n\r\n    load() {\r\n        if(window.audio_cache[this.state.url]) {\r\n            this.setState({\r\n                state: 'loaded',\r\n                data: window.audio_cache[this.state.url],\r\n            });\r\n            return;\r\n        }\r\n\r\n        console.log('fetching audio',this.state.url);\r\n        this.setState({\r\n            state: 'loading',\r\n        });\r\n        Promise.all([\r\n            fetch(this.state.url),\r\n            load_amrnb(),\r\n        ])\r\n            .then((res)=>{\r\n                res[0].blob().then((blob)=>{\r\n                    const reader=new FileReader();\r\n                    reader.onload=(event)=>{\r\n                        const raw=new window.AMR().decode(event.target.result);\r\n                        if(!raw) {\r\n                            alert('audio decoding failed');\r\n                            return;\r\n                        }\r\n                        const wave=window.PCMData.encode({\r\n                            sampleRate: 8000,\r\n                            channelCount: 1,\r\n                            bytesPerSample: 2,\r\n                            data: raw\r\n                        });\r\n                        const binary_wave=new Uint8Array(wave.length);\r\n                        for(let i=0;i<wave.length;i++)\r\n                            binary_wave[i]=wave.charCodeAt(i);\r\n\r\n                        const objurl=URL.createObjectURL(new Blob([binary_wave], {type: 'audio/wav'}));\r\n                        window.audio_cache[this.state.url]=objurl;\r\n                        this.setState({\r\n                            state: 'loaded',\r\n                            data: objurl,\r\n                        });\r\n                    };\r\n                    reader.readAsBinaryString(blob);\r\n                });\r\n                this.setState({\r\n                    state: 'decoding',\r\n                });\r\n            });\r\n    }\r\n\r\n    render() {\r\n        if(this.state.state==='waiting')\r\n            return (<p><a onClick={this.load.bind(this)}>加载音频</a></p>);\r\n        if(this.state.state==='loading')\r\n            return (<p>正在下载……</p>);\r\n        else if(this.state.state==='decoding')\r\n            return (<p>正在解码……</p>);\r\n        else if(this.state.state==='loaded')\r\n            return (<p><audio src={this.state.data} controls /></p>);\r\n    }\r\n}","import React, {Component, PureComponent} from 'react';\r\nimport {QKUHELPER_ROOT, get_json, API_VERSION_PARAM} from './flows_api';\r\nimport {Time} from './Common';\r\n\r\nexport class MessageViewer extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            loading_status: 'idle',\r\n            msg: [],\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.load();\r\n    }\r\n\r\n    load() {\r\n        if(this.state.loading_status==='loading') return;\r\n        this.setState({\r\n            loading_status: 'loading',\r\n        },()=>{\r\n            fetch(QKUHELPER_ROOT+'api_xmcp/hole/system_msg?user_token='+encodeURIComponent(this.props.token)+API_VERSION_PARAM())\r\n                .then(get_json)\r\n                .then((json)=>{\r\n                    if(json.error)\r\n                        throw new Error(json.error);\r\n                    else\r\n                        this.setState({\r\n                            loading_status: 'done',\r\n                            msg: json.result,\r\n                        });\r\n                })\r\n                .catch((err)=>{\r\n                    console.error(err);\r\n                    alert(''+err);\r\n                    this.setState({\r\n                        loading_status: 'failed',\r\n                    });\r\n                })\r\n\r\n        });\r\n    }\r\n\r\n    render() {\r\n        if(this.state.loading_status==='loading')\r\n            return (<p className=\"box box-tip\">加载中……</p>);\r\n        else if(this.state.loading_status==='failed')\r\n            return (<div className=\"box box-tip\"><a onClick={()=>{this.load()}}>重新加载</a></div>);\r\n        else if(this.state.loading_status==='done')\r\n            return this.state.msg.map((msg)=>(\r\n                <div className=\"box\">\r\n                    <div className=\"box-header\">\r\n                        <Time stamp={msg.timestamp} />\r\n                        &nbsp; <b>{msg.title}</b>\r\n                    </div>\r\n                    <div className=\"box-content\">\r\n                        <pre>{msg.content}</pre>\r\n                    </div>\r\n                </div>\r\n            ));\r\n        else\r\n            return null;\r\n    }\r\n}","import React, {Component, PureComponent} from 'react';\r\n\r\nimport './Config.css';\r\n\r\nconst BUILTIN_IMGS={\r\n    'static/bg/gbp.jpg': '寻觅繁星（默认）',\r\n    'static/bg/eriri.jpg': '平成著名画师',\r\n    'static/bg/yurucamp.jpg': '露营天下第一',\r\n    'static/bg/minecraft.jpg': '麦恩·库拉夫特',\r\n    'static/bg/sif.jpg': '梦开始的地方',\r\n};\r\n\r\nconst DEFAULT_CONFIG={\r\n    background_img: 'static/bg/gbp.jpg',\r\n    background_color: '#113366',\r\n    pressure: false,\r\n    easter_egg: true,\r\n    color_scheme: 'default',\r\n};\r\n\r\nexport function load_config() {\r\n    let config=Object.assign({},DEFAULT_CONFIG);\r\n    let loaded_config;\r\n    try {\r\n        loaded_config=JSON.parse(localStorage['hole_config']||'{}');\r\n    } catch(e) {\r\n        alert('设置加载失败，将重置为默认设置！\\n'+e);\r\n        delete localStorage['hole_config'];\r\n        loaded_config={};\r\n    }\r\n\r\n    // unrecognized configs are removed\r\n    Object.keys(loaded_config).forEach((key)=>{\r\n        if(config[key]!==undefined)\r\n            config[key]=loaded_config[key];\r\n    });\r\n\r\n    console.log('config loaded',config);\r\n    window.config=config;\r\n}\r\nexport function save_config() {\r\n    localStorage['hole_config']=JSON.stringify(window.config);\r\n    load_config();\r\n}\r\n\r\nexport function bgimg_style(img,color) {\r\n    if(img===undefined) img=window.config.background_img;\r\n    if(color===undefined) color=window.config.background_color;\r\n    return {\r\n        background: 'transparent center center',\r\n        backgroundImage: img===null ? 'unset' : 'url(\"'+encodeURI(img)+'\")',\r\n        backgroundColor: color,\r\n        backgroundSize: 'cover',\r\n    };\r\n}\r\n\r\nclass ConfigBackground extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            img: window.config.background_img,\r\n            color: window.config.background_color,\r\n        };\r\n    }\r\n\r\n    save_changes() {\r\n        this.props.callback({\r\n            background_img: this.state.img,\r\n            background_color: this.state.color,\r\n        });\r\n    }\r\n\r\n    on_select(e) {\r\n        let value=e.target.value;\r\n        this.setState({\r\n            img: value==='##other' ? '' :\r\n                 value==='##color' ? null : value,\r\n        },this.save_changes.bind(this));\r\n    }\r\n    on_change_img(e) {\r\n        this.setState({\r\n            img: e.target.value,\r\n        },this.save_changes.bind(this));\r\n    }\r\n    on_change_color(e) {\r\n        this.setState({\r\n            color: e.target.value,\r\n        },this.save_changes.bind(this));\r\n    }\r\n\r\n    render() {\r\n        let img_select= this.state.img===null ? '##color' :\r\n                        Object.keys(BUILTIN_IMGS).indexOf(this.state.img)===-1 ? '##other' : this.state.img;\r\n        return (\r\n            <div>\r\n                <p>\r\n                    <b>背景图片：</b>\r\n                    <select value={img_select} onChange={this.on_select.bind(this)}>\r\n                        {Object.keys(BUILTIN_IMGS).map((key)=>(\r\n                            <option key={key} value={key}>{BUILTIN_IMGS[key]}</option>\r\n                        ))}\r\n                        <option value=\"##other\">输入图片网址……</option>\r\n                        <option value=\"##color\">纯色背景……</option>\r\n                    </select>\r\n                    &nbsp;\r\n                    {img_select==='##other' &&\r\n                        <input type=\"url\" placeholder=\"图片网址\" value={this.state.img} onChange={this.on_change_img.bind(this)} />\r\n                    }\r\n                    {img_select==='##color' &&\r\n                        <input type=\"color\" value={this.state.color} onChange={this.on_change_color.bind(this)} />\r\n                    }\r\n                </p>\r\n                <div className=\"bg-preview\" style={bgimg_style(this.state.img,this.state.color)} />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nclass ConfigColorScheme extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            color_scheme: window.config.color_scheme,\r\n        };\r\n    }\r\n\r\n    save_changes() {\r\n        this.props.callback({\r\n            color_scheme: this.state.color_scheme,\r\n        });\r\n    }\r\n\r\n    on_select(e) {\r\n        let value=e.target.value;\r\n        this.setState({\r\n            color_scheme: value,\r\n        },this.save_changes.bind(this));\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <p>\r\n                    <b>夜间模式：</b>\r\n                    <select value={this.state.color_scheme} onChange={this.on_select.bind(this)}>\r\n                        <option value=\"default\">跟随系统</option>\r\n                        <option value=\"light\">始终浅色模式</option>\r\n                        <option value=\"dark\">始终深色模式</option>\r\n                    </select>\r\n                    &nbsp; <small>#color_scheme</small>\r\n                </p>\r\n                <p>\r\n                    选择浅色或深色模式，深色模式下将会调暗图片亮度\r\n                </p>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nclass ConfigSwitch extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            switch: window.config[this.props.id],\r\n        };\r\n    }\r\n\r\n    on_change(e) {\r\n        let val=e.target.checked;\r\n        this.setState({\r\n            switch: val,\r\n        },()=>{\r\n            this.props.callback({\r\n                [this.props.id]: val,\r\n            });\r\n        });\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <p>\r\n                    <label>\r\n                        <input name={'config-'+this.props.id} type=\"checkbox\" checked={this.state.switch} onChange={this.on_change.bind(this)} />\r\n                        <b>{this.props.name}</b>\r\n                        &nbsp; <small>#{this.props.id}</small>\r\n                    </label>\r\n                </p>\r\n                <p>\r\n                    {this.props.description}\r\n                </p>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport class ConfigUI extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n        this.save_changes_bound=this.save_changes.bind(this);\r\n    }\r\n\r\n    save_changes(chg) {\r\n        console.log(chg);\r\n        Object.keys(chg).forEach((key)=>{\r\n            window.config[key]=chg[key];\r\n        });\r\n        save_config();\r\n    }\r\n\r\n    reset_settings() {\r\n        if(window.confirm('重置所有设置？')) {\r\n            window.config={};\r\n            save_config();\r\n            window.location.reload();\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <div className=\"box config-ui-header\">\r\n                    <p>这些功能仍在测试，可能不稳定（<a onClick={this.reset_settings.bind(this)}>全部重置</a>）</p>\r\n                    <p><b>修改设置后 <a onClick={()=>{window.location.reload()}}>刷新页面</a> 方可生效</b></p>\r\n                </div>\r\n                <div className=\"box\">\r\n                    <ConfigBackground callback={this.save_changes_bound} />\r\n                    <hr />\r\n                    <ConfigColorScheme callback={this.save_changes_bound} />\r\n                    <hr />\r\n                    <ConfigSwitch callback={this.save_changes_bound} id=\"pressure\" name=\"快速返回\"\r\n                                  description=\"短暂按住 Esc 键或重压屏幕（3D Touch）可以快速返回或者刷新树洞\"\r\n                    />\r\n                    <hr />\r\n                    <ConfigSwitch callback={this.save_changes_bound} id=\"easter_egg\" name=\"允许彩蛋\"\r\n                                  description=\"在某些情况下显示彩蛋\"\r\n                    />\r\n                    <hr />\r\n                    <p>\r\n                        新功能建议或问题反馈请在&nbsp;\r\n                        <a>比赛结束后 :)</a>\r\n                        &nbsp;提出。\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n}","import React, {Component, PureComponent} from 'react';\r\nimport {API_BASE, SafeTextarea, PromotionBar} from './Common';\r\nimport {MessageViewer} from './Message';\r\nimport {LoginPopup} from './infrastructure/widgets';\r\nimport {ConfigUI} from './Config';\r\nimport fixOrientation from 'fix-orientation';\r\nimport copy from 'copy-to-clipboard';\r\nimport {cache} from './cache';\r\nimport {API_VERSION_PARAM, QKUHELPER_ROOT, API, get_json, token_param} from './flows_api';\r\n\r\nimport './UserAction.css';\r\n\r\nconst BASE64_RATE=4/3;\r\nconst MAX_IMG_DIAM=8000;\r\nconst MAX_IMG_PX=5000000;\r\nconst MAX_IMG_FILESIZE=450000*BASE64_RATE;\r\n\r\nexport const TokenCtx=React.createContext({\r\n    value: null,\r\n    set_value: ()=>{},\r\n});\r\n\r\nfunction todo_alert() {\r\n    alert('前面的区域以后再来探索吧！');\r\n}\r\n\r\nexport function InfoSidebar(props) {\r\n    return (\r\n        <div>\r\n            <PromotionBar />\r\n            <LoginForm show_sidebar={props.show_sidebar} />\r\n            <div className=\"box list-menu\">\r\n                <a onClick={()=>{props.show_sidebar(\r\n                    '设置',\r\n                    <ConfigUI />\r\n                )}}>\r\n                    <span className=\"icon icon-settings\" /><label>网页版树洞设置</label>\r\n                </a>\r\n                &nbsp;&nbsp;\r\n                <a onClick={todo_alert}>\r\n                    <span className=\"icon icon-textfile\" /><label>树洞规范</label>\r\n                </a>\r\n                &nbsp;&nbsp;\r\n                <a onClick={todo_alert}>\r\n                    <span className=\"icon icon-github\" /><label>意见反馈</label>\r\n                </a>\r\n            </div>\r\n            <div className=\"box help-desc-box\">\r\n                <p>\r\n                    Q小树洞 by @xmcp\r\n                </p>\r\n                <p>\r\n                    <a onClick={()=>{\r\n                        if('serviceWorker' in navigator) {\r\n                            navigator.serviceWorker.getRegistrations()\r\n                                .then((registrations)=>{\r\n                                    for(let registration of registrations) {\r\n                                        console.log('unregister',registration);\r\n                                        registration.unregister();\r\n                                    }\r\n                                });\r\n                        }\r\n                        cache().clear();\r\n                        setTimeout(()=>{\r\n                            window.location.reload(true);\r\n                        },200);\r\n                    }}>强制检查更新</a>\r\n                    （{process.env.REACT_APP_BUILD_INFO||'---'} {process.env.NODE_ENV} 会自动在后台检查更新并在下次访问时更新）\r\n                </p>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nclass ResetUsertokenWidget extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            loading_status: 'done',\r\n        };\r\n    }\r\n\r\n    do_reset() {\r\n        if(window.confirm('您正在重置 UserToken！\\n您的账号将会在【所有设备】上注销，您需要手动重新登录！')) {\r\n            let uid=window.prompt('您正在重置 UserToken！\\n请输入您的学号以确认身份：');\r\n            if(uid)\r\n                this.setState({\r\n                    loading_status: 'loading',\r\n                },()=>{\r\n                    fetch(QKUHELPER_ROOT+'api_xmcp/hole/reset_usertoken', {\r\n                        method: 'post',\r\n                        headers: {\r\n                            'Content-Type': 'application/json',\r\n                        },\r\n                        body: JSON.stringify({\r\n                            user_token: this.props.token,\r\n                            uid: uid,\r\n                        }),\r\n                    })\r\n                        .then(get_json)\r\n                        .then((json)=>{\r\n                            if(json.error)\r\n                                throw new Error(json.error);\r\n                            else\r\n                                alert('重置成功！您需要在所有设备上重新登录。');\r\n\r\n                            this.setState({\r\n                                loading_status: 'done',\r\n                            });\r\n                        })\r\n                        .catch((e)=>{\r\n                            alert('重置失败：'+e);\r\n                            this.setState({\r\n                                loading_status: 'done',\r\n                            });\r\n                        })\r\n                });\r\n        }\r\n    }\r\n\r\n    render() {\r\n        if(this.state.loading_status==='done')\r\n            return (<a onClick={this.do_reset.bind(this)}>重置</a>);\r\n        else if(this.state.loading_status==='loading')\r\n            return (<a><span className=\"icon icon-loading\" /></a>);\r\n    }\r\n}\r\n\r\nexport class LoginForm extends Component {\r\n    copy_token(token) {\r\n        if(copy(token))\r\n            alert('复制成功！\\n请一定不要泄露哦');\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <TokenCtx.Consumer>{(token)=>\r\n                <div>\r\n                    {/*!!token.value &&\r\n                        <LifeInfoBox token={token.value} set_token={token.set_value} />\r\n                    */}\r\n                    <div className=\"login-form box\">\r\n                        {token.value ?\r\n                            <div>\r\n                                <p>\r\n                                    <b>您已登录。</b>\r\n                                    <button type=\"button\" onClick={()=>{token.set_value(null);}}>\r\n                                        <span className=\"icon icon-logout\" /> 注销\r\n                                    </button>\r\n                                    <br />\r\n                                </p>\r\n                                <p>\r\n                                    根据相关要求，访问授权三个月内有效，过期需重新登录。\r\n                                </p>\r\n                                <p>\r\n                                    <a onClick={()=>{this.props.show_sidebar(\r\n                                        '系统消息',\r\n                                        <MessageViewer token={token.value} />\r\n                                    )}}>查看系统消息</a><br />\r\n                                    当您发送的内容违规时，我们将用系统消息提示您\r\n                                </p>\r\n                                <p>\r\n                                    <a onClick={this.copy_token.bind(this,token.value)}>复制 User Token</a><br />\r\n                                    User Token 用于迁移登录状态，切勿告知他人，若怀疑被盗号请尽快 <ResetUsertokenWidget token={token.value} />\r\n                                </p>\r\n                                <p>\r\n                                    <a onClick={todo_alert} target=\"_blank\">撤销信息授权</a>\r\n                                    <br />\r\n                                    警告：此操作会撤销您对 Q小树洞 的信息授权，并删除您账号下的数据\r\n                                </p>\r\n                            </div> :\r\n                            <LoginPopup token_callback={token.set_value}>{(do_popup)=>(\r\n                                <div>\r\n                                    <p>\r\n                                        <button type=\"button\" onClick={do_popup}>\r\n                                            <span className=\"icon icon-login\" />\r\n                                            &nbsp;登录\r\n                                        </button>\r\n                                    </p>\r\n                                    <p><small>\r\n                                        Q小树洞 面向Q小学生，通过魔法验证您的身份并提供服务。\r\n                                    </small></p>\r\n                                </div>\r\n                            )}</LoginPopup>\r\n                        }\r\n                    </div>\r\n                </div>\r\n            }</TokenCtx.Consumer>\r\n        )\r\n    }\r\n}\r\n\r\nexport class ReplyForm extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            text: '',\r\n            loading_status: 'done',\r\n        };\r\n        this.on_change_bound=this.on_change.bind(this);\r\n        this.area_ref=this.props.area_ref||React.createRef();\r\n        this.global_keypress_handler_bound=this.global_keypress_handler.bind(this);\r\n    }\r\n\r\n    global_keypress_handler(e) {\r\n        if(e.code==='Enter' && !e.ctrlKey && !e.altKey && ['input','textarea'].indexOf(e.target.tagName.toLowerCase())===-1) {\r\n            if(this.area_ref.current) {\r\n                e.preventDefault();\r\n                this.area_ref.current.focus();\r\n            }\r\n        }\r\n    }\r\n    componentDidMount() {\r\n        document.addEventListener('keypress',this.global_keypress_handler_bound);\r\n    }\r\n    componentWillUnmount() {\r\n        document.removeEventListener('keypress',this.global_keypress_handler_bound);\r\n    }\r\n\r\n    on_change(value) {\r\n        this.setState({\r\n            text: value,\r\n        });\r\n    }\r\n\r\n    on_submit(event) {\r\n        if(event) event.preventDefault();\r\n        if(this.state.loading_status==='loading')\r\n            return;\r\n        this.setState({\r\n            loading_status: 'loading',\r\n        });\r\n\r\n        let data=new URLSearchParams();\r\n        data.append('pid',this.props.pid);\r\n        data.append('text',this.state.text);\r\n        data.append('user_token',this.props.token);\r\n        fetch(API_BASE+'/api.php?action=docomment'+token_param(this.props.token), {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/x-www-form-urlencoded',\r\n            },\r\n            body: data,\r\n        })\r\n            .then(get_json)\r\n            .then((json)=>{\r\n                if(json.code!==0) {\r\n                    if(json.msg) alert(json.msg);\r\n                    throw new Error(JSON.stringify(json));\r\n                }\r\n\r\n                this.setState({\r\n                    loading_status: 'done',\r\n                    text: '',\r\n                });\r\n                this.area_ref.current.clear();\r\n                this.props.on_complete();\r\n            })\r\n            .catch((e)=>{\r\n                console.error(e);\r\n                alert('回复失败');\r\n                this.setState({\r\n                    loading_status: 'done',\r\n                });\r\n            });\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <form onSubmit={this.on_submit.bind(this)} className={'reply-form box'+(this.state.text?' reply-sticky':'')}>\r\n                <SafeTextarea key={this.props.pid} ref={this.area_ref} id={this.props.pid} on_change={this.on_change_bound} on_submit={this.on_submit.bind(this)} />\r\n                {this.state.loading_status==='loading' ?\r\n                    <button disabled=\"disabled\">\r\n                        <span className=\"icon icon-loading\" />\r\n                    </button> :\r\n                    <button type=\"submit\">\r\n                        <span className=\"icon icon-send\" />\r\n                    </button>\r\n                }\r\n            </form>\r\n        )\r\n    }\r\n}\r\n\r\nexport class PostForm extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            text: '',\r\n            loading_status: 'done',\r\n            img_tip: null,\r\n        };\r\n        this.img_ref=React.createRef();\r\n        this.area_ref=React.createRef();\r\n        this.on_change_bound=this.on_change.bind(this);\r\n        this.on_img_change_bound=this.on_img_change.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        if(this.area_ref.current)\r\n            this.area_ref.current.focus();\r\n    }\r\n\r\n    on_change(value) {\r\n        this.setState({\r\n            text: value,\r\n        });\r\n    }\r\n\r\n    do_post(text,img) {\r\n        let data=new URLSearchParams();\r\n        data.append('text',this.state.text);\r\n        data.append('type',img ? 'image' : 'text');\r\n        data.append('user_token',this.props.token);\r\n        if(img)\r\n            data.append('data',img);\r\n\r\n        fetch(API_BASE+'/api.php?action=dopost'+token_param(this.props.token), {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/x-www-form-urlencoded',\r\n            },\r\n            body: data,\r\n        })\r\n            .then(get_json)\r\n            .then((json)=>{\r\n                if(json.code!==0) {\r\n                    if(json.msg) alert(json.msg);\r\n                    throw new Error(JSON.stringify(json));\r\n                }\r\n\r\n                this.setState({\r\n                    loading_status: 'done',\r\n                    text: '',\r\n                });\r\n                this.area_ref.current.clear();\r\n                this.props.on_complete();\r\n            })\r\n            .catch((e)=>{\r\n                console.error(e);\r\n                alert('发表失败');\r\n                this.setState({\r\n                    loading_status: 'done',\r\n                });\r\n            });\r\n    }\r\n\r\n    proc_img(file) {\r\n        return new Promise((resolve,reject)=>{\r\n            function return_url(url) {\r\n                const idx=url.indexOf(';base64,');\r\n                if(idx===-1)\r\n                    throw new Error('img not base64 encoded');\r\n\r\n                return url.substr(idx+8);\r\n            }\r\n\r\n            let reader=new FileReader();\r\n            function on_got_img(url) {\r\n                const image = new Image();\r\n                image.onload=(()=>{\r\n                    let width=image.width;\r\n                    let height=image.height;\r\n                    let compressed=false;\r\n                    \r\n                    if(width>MAX_IMG_DIAM) {\r\n                        height=height*MAX_IMG_DIAM/width;\r\n                        width=MAX_IMG_DIAM;\r\n                        compressed=true;\r\n                    }\r\n                    if(height>MAX_IMG_DIAM) {\r\n                        width=width*MAX_IMG_DIAM/height;\r\n                        height=MAX_IMG_DIAM;\r\n                        compressed=true;\r\n                    }\r\n                    if(height*width>MAX_IMG_PX) {\r\n                        let rate=Math.sqrt(height*width/MAX_IMG_PX);\r\n                        height/=rate;\r\n                        width/=rate;\r\n                        compressed=true;\r\n                    }\r\n                    console.log('chosen img size',width,height);\r\n\r\n                    let canvas=document.createElement('canvas');\r\n                    let ctx=canvas.getContext('2d');\r\n                    canvas.width=width;\r\n                    canvas.height=height;\r\n                    ctx.drawImage(image,0,0,width,height);\r\n\r\n                    let quality_l=.1,quality_r=.9,quality,new_url;\r\n                    while(quality_r-quality_l>=.03) {\r\n                        quality=(quality_r+quality_l)/2;\r\n                        new_url=canvas.toDataURL('image/jpeg',quality);\r\n                        console.log(quality_l,quality_r,'trying quality',quality,'size',new_url.length);\r\n                        if(new_url.length<=MAX_IMG_FILESIZE)\r\n                            quality_l=quality;\r\n                        else\r\n                            quality_r=quality;\r\n                    }\r\n                    if(quality_l>=.101) {\r\n                        console.log('chosen img quality',quality);\r\n                        resolve({\r\n                            img: return_url(new_url),\r\n                            quality: quality,\r\n                            width: Math.round(width),\r\n                            height: Math.round(height),\r\n                            compressed: compressed,\r\n                        });\r\n                    } else {\r\n                        reject('图片过大，无法上传');\r\n                    }\r\n                });\r\n                image.src=url;\r\n            }\r\n            reader.onload=(event)=>{\r\n                fixOrientation(event.target.result,{},(fixed_dataurl)=>{\r\n                    on_got_img(fixed_dataurl);\r\n                });\r\n            };\r\n            reader.readAsDataURL(file);\r\n        });\r\n    }\r\n\r\n    on_img_change() {\r\n        if(this.img_ref.current && this.img_ref.current.files.length)\r\n            this.setState({\r\n                img_tip: '（正在处理图片……）'\r\n            },()=>{\r\n                this.proc_img(this.img_ref.current.files[0])\r\n                    .then((d)=>{\r\n                        this.setState({\r\n                            img_tip: `（${d.compressed?'压缩到':'尺寸'} ${d.width}*${d.height} / `+\r\n                                `质量 ${Math.floor(d.quality*100)}% / ${Math.floor(d.img.length/BASE64_RATE/1000)}KB）`,\r\n                        });\r\n                    })\r\n                    .catch((e)=>{\r\n                        this.setState({\r\n                            img_tip: `图片无效：${e}`,\r\n                        });\r\n                    });\r\n            });\r\n        else\r\n            this.setState({\r\n                img_tip: null,\r\n            });\r\n    }\r\n\r\n    on_submit(event) {\r\n        if(event) event.preventDefault();\r\n        if(this.state.loading_status==='loading')\r\n            return;\r\n        if(this.img_ref.current.files.length) {\r\n            this.setState({\r\n                loading_status: 'processing',\r\n            });\r\n            this.proc_img(this.img_ref.current.files[0])\r\n                .then((d)=>{\r\n                    this.setState({\r\n                        loading_status: 'loading',\r\n                    });\r\n                    this.do_post(this.state.text,d.img);\r\n                })\r\n                .catch((e)=>{\r\n                    alert(e);\r\n                });\r\n        } else {\r\n            this.setState({\r\n                loading_status: 'loading',\r\n            });\r\n            this.do_post(this.state.text,null);\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <form onSubmit={this.on_submit.bind(this)} className=\"post-form box\">\r\n                <div className=\"post-form-bar\">\r\n                    <label>\r\n                        图片\r\n                        <input ref={this.img_ref} type=\"file\" accept=\"image/*\" disabled={this.state.loading_status!=='done'}\r\n                               onChange={this.on_img_change_bound}\r\n                        />\r\n                    </label>\r\n                    {this.state.loading_status!=='done' ?\r\n                        <button disabled=\"disabled\">\r\n                            <span className=\"icon icon-loading\" />\r\n                            &nbsp;正在{this.state.loading_status==='processing' ? '处理' : '上传'}\r\n                        </button> :\r\n                        <button type=\"submit\">\r\n                            <span className=\"icon icon-send\" />\r\n                            &nbsp;发表\r\n                        </button>\r\n                    }\r\n                </div>\r\n                {!!this.state.img_tip &&\r\n                    <p className=\"post-form-img-tip\">\r\n                        <a onClick={()=>{this.img_ref.current.value=\"\"; this.on_img_change();}}>删除图片</a>\r\n                        {this.state.img_tip}\r\n                    </p>\r\n                }\r\n                <SafeTextarea ref={this.area_ref} id=\"new_post\" on_change={this.on_change_bound} on_submit={this.on_submit.bind(this)} />\r\n                <p><small>\r\n                    请遵守<a onClick={todo_alert}>树洞管理规范</a>，文明发言\r\n                </small></p>\r\n            </form>\r\n        )\r\n    }\r\n}","import React, {createContext, useState, useContext, useRef, useEffect} from 'react';\r\nimport {createPortal} from 'react-dom';\r\nimport {GoogleReCaptchaProvider, useGoogleReCaptcha} from 'react-google-recaptcha-v3';\r\n\r\nimport './Captcha.css';\r\nimport {QKUHELPER_ROOT, token_param, get_json} from './flows_api';\r\nimport {TokenCtx} from './UserAction';\r\n\r\nconst KEY_MAX=100000000;\r\nconst RECAPTCHA_KEY='6LeV_9MZAAAAAAwKy_IxuozNJ-96sbBIujsqUSXn';\r\n\r\nlet CaptchaCtx=createContext({\r\n    get_key: ()=>-1,\r\n    add_listener: (k,fn)=>{},\r\n    remove_listener: (k)=>{},\r\n});\r\n\r\n\r\nfunction CaptchaSelf(props) {\r\n    let [portal_dom,_]=useState(()=>document.createElement('div'));\r\n    let {executeRecaptcha: exe_recaptcha}=useGoogleReCaptcha();\r\n    let {value: token}=useContext(TokenCtx);\r\n    let [hint_msg,set_hint_msg]=useState('请完成人机验证');\r\n\r\n    useEffect(()=>{\r\n        document.body.appendChild(portal_dom);\r\n        return ()=>{\r\n            portal_dom.parentNode.removeChild(portal_dom);\r\n        };\r\n    },[]);\r\n\r\n    function run_captcha() {\r\n        set_hint_msg('正在进行人机验证');\r\n        console.log('captcha: exec');\r\n        exe_recaptcha('hole')\r\n            . then((captcha_result)=>{\r\n                set_hint_msg('正在检查人机验证');\r\n                console.log('captcha: submit');\r\n\r\n                let data=new URLSearchParams();\r\n                data.append('recaptcha',captcha_result);\r\n                return fetch(QKUHELPER_ROOT+'services/qkuhole/api.php?action=captcha'+token_param(token), {\r\n                    method: 'post',\r\n                    headers: {\r\n                        'Content-Type': 'application/x-www-form-urlencoded',\r\n                    },\r\n                    body: data,\r\n                })\r\n            })\r\n            .then(get_json)\r\n            .then((json)=>{\r\n                if(json.code!==0)\r\n                    throw new Error(json.msg||JSON.stringify(json));\r\n\r\n                set_hint_msg('人机验证完成');\r\n            })\r\n            .then(()=>{\r\n                props.onFinish();\r\n            })\r\n            .catch((e)=>{\r\n                alert('人机验证失败：'+e);\r\n                set_hint_msg('人机验证失败');\r\n            });\r\n    }\r\n\r\n    useEffect(()=>{\r\n        run_captcha();\r\n    },[]);\r\n\r\n    return createPortal(\r\n        <div className=\"captcha-self\">\r\n            <div className=\"box box-tip\">\r\n                {hint_msg}\r\n                （<a onClick={run_captcha}>重试</a>）\r\n            </div>\r\n        </div>,\r\n        portal_dom,\r\n    );\r\n}\r\n\r\nexport function CaptchaRoot(props) {\r\n    let listeners=useRef([]);\r\n    let [should_show_self, set_should_show_self]=useState(false);\r\n    let key=useRef(0);\r\n\r\n    function captcha_done() {\r\n        let l=listeners.current.slice();\r\n        listeners.current=[];\r\n        set_should_show_self(false);\r\n        l.forEach(([k,fn])=>{\r\n            console.log('captcha: callback',k);\r\n            fn();\r\n        });\r\n    }\r\n\r\n    return (\r\n        <CaptchaCtx.Provider value={{\r\n            get_key: ()=>{\r\n                if((++key.current)>=KEY_MAX)\r\n                    key.current%=KEY_MAX;\r\n                return key.current;\r\n            },\r\n            add_listener: (k,fn)=>{\r\n                if(k===null) return;\r\n                if(listeners.current.some(([ik,_ifn])=>ik===k))\r\n                    return;\r\n                console.log('captcha: add',k);\r\n                listeners.current.push([k,fn]);\r\n                set_should_show_self(true);\r\n            },\r\n            remove_listener: (k)=>{\r\n                console.log('captcha: remove',k);\r\n                listeners.current=listeners.current.filter(([ik,_ifn])=>ik!==k);\r\n                if(listeners.current.length===0)\r\n                    set_should_show_self(false);\r\n            },\r\n        }}>\r\n            <GoogleReCaptchaProvider reCaptchaKey={RECAPTCHA_KEY} language=\"zh-CN\" useRecaptchaNet={true}>\r\n                {props.children}\r\n                {should_show_self &&\r\n                    <CaptchaSelf onFinish={captcha_done} />\r\n                }\r\n            </GoogleReCaptchaProvider>\r\n        </CaptchaCtx.Provider>\r\n    )\r\n}\r\n\r\nexport function CaptchaClient(props) {\r\n    let ctx=useContext(CaptchaCtx);\r\n    let k=useRef(null);\r\n\r\n    useEffect(()=>{\r\n        k.current=ctx.get_key();\r\n        ctx.add_listener(k.current,props.onFinish);\r\n        return ()=>{\r\n            ctx.remove_listener(k.current);\r\n        }\r\n    },[]);\r\n\r\n    return (\r\n        <p>\r\n            <a onClick={()=>{\r\n                ctx.add_listener(k.current,props.onFinish);\r\n            }}>进行人机验证</a>\r\n            （<a onClick={props.onFinish}>完成</a>）\r\n        </p>\r\n    );\r\n}","import React, {Component, PureComponent} from 'react';\r\nimport copy from 'copy-to-clipboard';\r\nimport {ColorPicker} from './color_picker';\r\nimport {split_text, NICKNAME_RE, PID_RE, URL_RE, URL_PID_RE} from './text_splitter';\r\nimport {format_time, build_highlight_re, Time, TitleLine, HighlightedText, ClickHandler, ColoredSpan} from './Common';\r\nimport './Flows.css';\r\nimport LazyLoad from './react-lazyload/src';\r\nimport {AudioWidget} from './AudioWidget';\r\nimport {TokenCtx, ReplyForm} from './UserAction';\r\n\r\nimport {API, QKUHELPER_ROOT} from './flows_api';\r\nimport {CaptchaClient} from './Captcha';\r\n\r\nconst IMAGE_BASE=QKUHELPER_ROOT+'services/qkuhole/images/';\r\nconst AUDIO_BASE=QKUHELPER_ROOT+'services/qkuhole/audios/';\r\n\r\nconst CLICKABLE_TAGS={a: true, audio: true};\r\nconst PREVIEW_REPLY_COUNT=10;\r\nconst QUOTE_BLACKLIST=['23333','233333','66666','666666','10086','10000','100000','99999','999999','55555','555555'];\r\n\r\nwindow.LATEST_POST_ID=parseInt(localStorage['_LATEST_POST_ID'],10)||0;\r\n\r\nconst DZ_NAME='洞主';\r\n\r\nfunction load_single_meta(show_sidebar,token) {\r\n    return (pid,replace=false)=>{\r\n        let color_picker=new ColorPicker();\r\n        let title_elem='树洞 #'+pid;\r\n        show_sidebar(\r\n            title_elem,\r\n            <div className=\"box box-tip\">\r\n                正在加载 #{pid}\r\n            </div>,\r\n            replace?'replace':'push'\r\n        );\r\n        API.get_single(pid,token)\r\n            .then((single)=>{\r\n                single.data.variant={};\r\n                return new Promise((resolve,reject)=>{\r\n                    API.load_replies_with_cache(pid,token,color_picker,parseInt(single.data.reply))\r\n                        .then((replies)=>{resolve([single,replies])})\r\n                        .catch(reject);\r\n                });\r\n            })\r\n            .then((res)=>{\r\n                let [single,replies]=res;\r\n                show_sidebar(\r\n                    title_elem,\r\n                    <FlowSidebar key={+new Date()}\r\n                        info={single.data} replies={replies.data} attention={replies.attention}\r\n                        token={token} show_sidebar={show_sidebar} color_picker={color_picker}\r\n                        deletion_detect={localStorage['DELETION_DETECT']==='on'}\r\n                    />,\r\n                    'replace'\r\n                )\r\n            })\r\n            .catch((e)=>{\r\n                console.error(e);\r\n                show_sidebar(\r\n                    title_elem,\r\n                    <div className=\"box box-tip\">\r\n                        <p><a onClick={()=>load_single_meta(show_sidebar,token)(pid,true)}>重新加载</a></p>\r\n                        <p>{''+e}</p>\r\n                        {e==='CAPTCHA' &&\r\n                            <CaptchaClient onFinish={()=>load_single_meta(show_sidebar,token)(pid,true)} />\r\n                        }\r\n                    </div>,\r\n                    'replace'\r\n                );\r\n            })\r\n    };\r\n}\r\n\r\nclass Reply extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n    }\r\n\r\n    render() {\r\n        let parts=split_text(this.props.info.text,[\r\n            ['url_pid',URL_PID_RE],\r\n            ['url',URL_RE],\r\n            ['pid',PID_RE],\r\n            ['nickname',NICKNAME_RE],\r\n        ]);\r\n\r\n        return (\r\n            <div className={'flow-reply box'} style={this.props.info._display_color ? {\r\n                '--box-bgcolor-light': this.props.info._display_color[0],\r\n                '--box-bgcolor-dark': this.props.info._display_color[1],\r\n            } : null}>\r\n                <div className=\"box-header\">\r\n                    <code className=\"box-id\">#{this.props.info.cid}</code>\r\n                    {!!this.props.do_filter_name &&\r\n                        <span className=\"reply-header-badge clickable\" onClick={()=>{this.props.do_filter_name(this.props.info.name);}}>\r\n                            <span className=\"icon icon-locate\" />\r\n                        </span>\r\n                    }\r\n                    &nbsp;\r\n                    {this.props.info.tag!==null &&\r\n                        <span className=\"box-header-tag\">\r\n                                {this.props.info.tag}\r\n                            </span>\r\n                    }\r\n                    <Time stamp={this.props.info.timestamp} />\r\n                </div>\r\n                <div className=\"box-content\">\r\n                    <HighlightedText parts={parts} color_picker={this.props.color_picker} show_pid={this.props.show_pid} />\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nclass FlowItem extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n    }\r\n\r\n    copy_link(event) {\r\n        event.preventDefault();\r\n        copy(\r\n            `${event.target.href}${this.props.info.tag ? ' 【'+this.props.info.tag+'】' : ''}\\n`+\r\n            `${this.props.info.text}${this.props.info.type==='image'?' [图片]':this.props.info.type==='audio'?' [语音]':''}\\n`+\r\n            `（${format_time(new Date(this.props.info.timestamp*1000))} ${this.props.info.likenum}关注 ${this.props.info.reply}回复）\\n`+\r\n            this.props.replies.map((r)=>(\r\n                (r.tag ? '【'+r.tag+'】' : '')+\r\n                r.text\r\n            )).join('\\n')\r\n        );\r\n    }\r\n\r\n    render() {\r\n        let props=this.props;\r\n        let parts=props.parts||split_text(props.info.text,[\r\n            ['url_pid',URL_PID_RE],\r\n            ['url',URL_RE],\r\n            ['pid',PID_RE],\r\n            ['nickname',NICKNAME_RE],\r\n        ]);\r\n        return (\r\n            <div className={'flow-item'+(props.is_quote ? ' flow-item-quote' : '')}>\r\n                {!!props.is_quote &&\r\n                    <div className=\"quote-tip black-outline\">\r\n                        <div><span className=\"icon icon-quote\" /></div>\r\n                        <div><small>提到</small></div>\r\n                    </div>\r\n                }\r\n                <div className=\"box\">\r\n                    {!!window.LATEST_POST_ID && parseInt(props.info.pid,10)>window.LATEST_POST_ID &&\r\n                        <div className=\"flow-item-dot\" />\r\n                    }\r\n                    <div className=\"box-header\">\r\n                        {!!this.props.do_filter_name &&\r\n                            <span className=\"reply-header-badge clickable\" onClick={()=>{this.props.do_filter_name(DZ_NAME);}}>\r\n                                <span className=\"icon icon-locate\" />\r\n                            </span>\r\n                        }\r\n                        {!!parseInt(props.info.likenum,10) &&\r\n                            <span className=\"box-header-badge\">\r\n                                {props.info.likenum}&nbsp;\r\n                                <span className={'icon icon-'+(props.attention ? 'star-ok' : 'star')} />\r\n                            </span>\r\n                        }\r\n                        {!!parseInt(props.info.reply,10) &&\r\n                            <span className=\"box-header-badge\">\r\n                                {props.info.reply}&nbsp;\r\n                                <span className=\"icon icon-reply\" />\r\n                            </span>\r\n                        }\r\n                        <code className=\"box-id\"><a href={'##'+props.info.pid} onClick={this.copy_link.bind(this)}>#{props.info.pid}</a></code>\r\n                        &nbsp;\r\n                        {props.info.tag!==null &&\r\n                            <span className=\"box-header-tag\">\r\n                                {props.info.tag}\r\n                            </span>\r\n                        }\r\n                        <Time stamp={props.info.timestamp} />\r\n                    </div>\r\n                    <div className=\"box-content\">\r\n                        <HighlightedText parts={parts} color_picker={props.color_picker} show_pid={props.show_pid} />\r\n                        {props.info.type==='image' &&\r\n                            <p className=\"img\">\r\n                                {props.img_clickable ?\r\n                                    <a className=\"no-underline\" href={IMAGE_BASE+props.info.url} target=\"_blank\"><img src={IMAGE_BASE+props.info.url} /></a> :\r\n                                    <img src={IMAGE_BASE+props.info.url} />\r\n                                }\r\n                            </p>\r\n                        }\r\n                        {props.info.type==='audio' && <AudioWidget src={AUDIO_BASE+props.info.url} />}\r\n                    </div>\r\n                    {!!(props.attention && props.info.variant.latest_reply) &&\r\n                        <p className=\"box-footer\">最新回复 <Time stamp={props.info.variant.latest_reply} /></p>\r\n                    }\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nclass FlowSidebar extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            attention: props.attention,\r\n            info: props.info,\r\n            replies: props.replies,\r\n            loading_status: 'done',\r\n            error_msg: null,\r\n            filter_name: null,\r\n            rev: false,\r\n        };\r\n        this.color_picker=props.color_picker;\r\n        this.syncState=props.sync_state||(()=>{});\r\n        this.reply_ref=React.createRef();\r\n    }\r\n\r\n    set_variant(cid,variant) {\r\n        this.setState((prev)=>{\r\n            if(cid)\r\n                return {\r\n                    replies: prev.replies.map((reply)=>{\r\n                        if(reply.cid===cid)\r\n                            return Object.assign({},reply,{variant: Object.assign({},reply.variant,variant)});\r\n                        else\r\n                            return reply;\r\n                    }),\r\n                };\r\n            else\r\n                return {\r\n                    info: Object.assign({},prev.info,{variant: Object.assign({},prev.info.variant,variant)}),\r\n                }\r\n        },function() {\r\n            this.syncState({\r\n                info: this.state.info,\r\n                replies: this.state.replies,\r\n            });\r\n        });\r\n    }\r\n\r\n    load_replies(update_count=true) {\r\n        this.setState({\r\n            loading_status: 'loading',\r\n            error_msg: null,\r\n        });\r\n        API.load_replies(this.state.info.pid,this.props.token,this.color_picker,null)\r\n            .then((json)=>{\r\n                this.setState((prev,props)=>({\r\n                    replies: json.data,\r\n                    info: update_count ? Object.assign({}, prev.info, {\r\n                        reply: ''+json.data.length,\r\n                    }) : prev.info,\r\n                    attention: !!json.attention,\r\n                    loading_status: 'done',\r\n                    error_msg: null,\r\n                }), ()=>{\r\n                    this.syncState({\r\n                        replies: this.state.replies,\r\n                        attention: this.state.attention,\r\n                        info: this.state.info,\r\n                    });\r\n                    if(this.state.replies.length)\r\n                        this.set_variant(null,{latest_reply: Math.max.apply(null,this.state.replies.map((r)=>parseInt(r.timestamp)))});\r\n                });\r\n            })\r\n            .catch((e)=>{\r\n                console.error(e);\r\n                this.setState({\r\n                    replies: [],\r\n                    loading_status: 'done',\r\n                    error_msg: ''+e,\r\n                });\r\n            });\r\n    }\r\n\r\n    toggle_attention() {\r\n        this.setState({\r\n            loading_status: 'loading',\r\n        });\r\n        const next_attention=!this.state.attention;\r\n        API.set_attention(this.state.info.pid,next_attention,this.props.token)\r\n            .then((json)=>{\r\n                this.setState({\r\n                    loading_status: 'done',\r\n                    attention: next_attention,\r\n                });\r\n                this.syncState({\r\n                    attention: next_attention,\r\n                });\r\n            })\r\n            .catch((e)=>{\r\n                this.setState({\r\n                    loading_status: 'done'\r\n                });\r\n                alert('设置关注失败');\r\n                console.error(e);\r\n            });\r\n    }\r\n\r\n    report() {\r\n        let reason=prompt(`举报 #${this.state.info.pid} 的理由：`);\r\n        if(reason!==null) {\r\n            API.report(this.state.info.pid,reason,this.props.token)\r\n                .then((json)=>{\r\n                    alert('举报成功');\r\n                })\r\n                .catch((e)=>{\r\n                    alert('举报失败');\r\n                    console.error(e);\r\n                })\r\n        }\r\n    }\r\n\r\n    set_filter_name(name) {\r\n        this.setState((prevState)=>({\r\n            filter_name: name===prevState.filter_name ? null : name,\r\n        }));\r\n    }\r\n\r\n    toggle_rev() {\r\n        this.setState((prevState)=>({\r\n            rev: !prevState.rev,\r\n        }));\r\n    }\r\n\r\n    show_reply_bar(name,event) {\r\n        if(this.reply_ref.current && !event.target.closest('a, .clickable')) {\r\n            let text=this.reply_ref.current.get();\r\n            if(/^\\s*(?:Re (?:|洞主|(?:[A-Z][a-z]+ )?(?:[A-Z][a-z]+)|You Win(?: \\d+)?):)?\\s*$/.test(text)) {// text is nearly empty so we can replace it\r\n                let should_text='Re '+name+': ';\r\n                if(should_text===this.reply_ref.current.get())\r\n                    this.reply_ref.current.set('');\r\n                else\r\n                    this.reply_ref.current.set(should_text);\r\n            }\r\n        }\r\n    }\r\n\r\n    render() {\r\n        if(this.state.loading_status==='loading')\r\n            return (<p className=\"box box-tip\">加载中……</p>);\r\n\r\n        let show_pid=load_single_meta(this.props.show_sidebar,this.props.token);\r\n\r\n        let replies_to_show=this.state.filter_name ? this.state.replies.filter((r)=>r.name===this.state.filter_name) : this.state.replies.slice();\r\n        if(this.state.rev) replies_to_show.reverse();\r\n\r\n        // key for lazyload elem\r\n        let view_mode_key=(this.state.rev ? 'y-' : 'n-')+(this.state.filter_name||'null');\r\n\r\n        let replies_cnt={[DZ_NAME]:1};\r\n        replies_to_show.forEach((r)=>{\r\n            if(replies_cnt[r.name]===undefined)\r\n                replies_cnt[r.name]=0;\r\n            replies_cnt[r.name]++;\r\n        });\r\n\r\n        // hide main thread when filtered\r\n        let main_thread_elem=(this.state.filter_name && this.state.filter_name!==DZ_NAME) ? null : (\r\n            <ClickHandler callback={(e)=>{this.show_reply_bar('',e);}}>\r\n                <FlowItem info={this.state.info} attention={this.state.attention} img_clickable={true}\r\n                          color_picker={this.color_picker} show_pid={show_pid} replies={this.state.replies}\r\n                          set_variant={(variant)=>{this.set_variant(null,variant);}}\r\n                          do_filter_name={replies_cnt[DZ_NAME]>1 ? this.set_filter_name.bind(this) : null}\r\n                />\r\n            </ClickHandler>\r\n        );\r\n\r\n        return (\r\n            <div className=\"flow-item-row sidebar-flow-item\">\r\n                <div className=\"box box-tip\">\r\n                    {!!this.props.token &&\r\n                        <span>\r\n                            <a onClick={this.report.bind(this)}>\r\n                                <span className=\"icon icon-flag\" /><label>举报</label>\r\n                            </a>\r\n                            &nbsp;&nbsp;\r\n                        </span>\r\n                    }\r\n                    <a onClick={this.load_replies.bind(this)}>\r\n                        <span className=\"icon icon-refresh\" /><label>刷新</label>\r\n                    </a>\r\n                    {(this.state.replies.length>=1 || this.state.rev) &&\r\n                        <span>\r\n                            &nbsp;&nbsp;\r\n                            <a onClick={this.toggle_rev.bind(this)}>\r\n                                <span className=\"icon icon-order-rev\" /><label>{this.state.rev ? '还原' : '逆序'}</label>\r\n                            </a>\r\n                        </span>\r\n                    }\r\n                    {!!this.props.token &&\r\n                        <span>\r\n                            &nbsp;&nbsp;\r\n                            <a onClick={()=>{\r\n                                this.toggle_attention();\r\n                            }}>\r\n                                {this.state.attention ?\r\n                                    <span><span className=\"icon icon-star-ok\" /><label>已关注</label></span> :\r\n                                    <span><span className=\"icon icon-star\" /><label>未关注</label></span>\r\n                                }\r\n                            </a>\r\n                        </span>\r\n                    }\r\n                </div>\r\n                {!!this.state.filter_name &&\r\n                    <div className=\"box box-tip flow-item filter-name-bar\">\r\n                        <p>\r\n                            <span style={{float: 'left'}}><a onClick={()=>{this.set_filter_name(null)}}>还原</a></span>\r\n                            <span className=\"icon icon-locate\" />&nbsp;当前只看&nbsp;\r\n                            <ColoredSpan colors={this.color_picker.get(this.state.filter_name)}>{this.state.filter_name}</ColoredSpan>\r\n                        </p>\r\n                    </div>\r\n                }\r\n                {!this.state.rev &&\r\n                    main_thread_elem\r\n                }\r\n                {this.state.error_msg==='CAPTCHA' &&\r\n                    <div className=\"box box-tip flow-item\">\r\n                        <CaptchaClient onFinish={()=>this.load_replies()} />\r\n                    </div>\r\n                }\r\n                {!!this.state.error_msg &&\r\n                <div className=\"box box-tip flow-item\">\r\n                        <p>回复加载失败</p>\r\n                        <p>{this.state.error_msg}</p>\r\n                    </div>\r\n                }\r\n                {(this.props.deletion_detect && parseInt(this.state.info.reply)>this.state.replies.length) && !!this.state.replies.length &&\r\n                    <div className=\"box box-tip flow-item box-danger\">\r\n                        {parseInt(this.state.info.reply)-this.state.replies.length} 条回复被删除\r\n                    </div>\r\n                }\r\n                {replies_to_show.map((reply)=>(\r\n                    <LazyLoad key={reply.cid+view_mode_key} offset={1500} height=\"5em\" overflow={true} once={true}>\r\n                        <ClickHandler callback={(e)=>{this.show_reply_bar(reply.name,e);}}>\r\n                            <Reply\r\n                                info={reply} color_picker={this.color_picker} show_pid={show_pid}\r\n                                set_variant={(variant)=>{this.set_variant(reply.cid,variant);}}\r\n                                do_filter_name={replies_cnt[reply.name]>1 ? this.set_filter_name.bind(this) : null}\r\n                            />\r\n                        </ClickHandler>\r\n                    </LazyLoad>\r\n                ))}\r\n                {this.state.rev &&\r\n                    main_thread_elem\r\n                }\r\n                {!!this.props.token ?\r\n                    <ReplyForm pid={this.state.info.pid} token={this.props.token}\r\n                               area_ref={this.reply_ref} on_complete={this.load_replies.bind(this)} /> :\r\n                    <div className=\"box box-tip flow-item\">登录后可以回复树洞</div>\r\n                }\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nclass FlowItemRow extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            replies: [],\r\n            reply_status: 'done',\r\n            reply_error: null,\r\n            info: Object.assign({},props.info,{variant: {}}),\r\n            attention: props.attention_override===null ? false : props.attention_override,\r\n        };\r\n        this.color_picker=new ColorPicker();\r\n    }\r\n\r\n    componentDidMount() {\r\n        if(parseInt(this.state.info.reply,10)) {\r\n            this.load_replies(null,/*update_count=*/false);\r\n        }\r\n    }\r\n\r\n    load_replies(callback,update_count=true) {\r\n        console.log('fetching reply',this.state.info.pid);\r\n        this.setState({\r\n            reply_status: 'loading',\r\n            reply_error: null,\r\n        });\r\n        API.load_replies_with_cache(this.state.info.pid,this.props.token,this.color_picker,parseInt(this.state.info.reply))\r\n            .then((json)=>{\r\n                this.setState((prev,props)=>({\r\n                    replies: json.data,\r\n                    info: Object.assign({}, prev.info, {\r\n                        reply: update_count ? ''+json.data.length : prev.info.reply,\r\n                        variant: json.data.length ? {\r\n                            latest_reply: Math.max.apply(null,json.data.map((r)=>parseInt(r.timestamp))),\r\n                        } : {},\r\n                    }),\r\n                    attention: !!json.attention,\r\n                    reply_status: 'done',\r\n                    reply_error: null,\r\n                }),callback);\r\n            })\r\n            .catch((e)=>{\r\n                if(e==='CAPTCHA') {\r\n                    this.setState({\r\n                        replies: [],\r\n                        reply_status: 'captcha',\r\n                    });\r\n                    return;\r\n                }\r\n\r\n                console.error(e);\r\n                this.setState({\r\n                    replies: [],\r\n                    reply_status: 'failed',\r\n                    reply_error: ''+e,\r\n                },callback);\r\n            });\r\n    }\r\n\r\n    show_sidebar() {\r\n        this.props.show_sidebar(\r\n            '树洞 #'+this.state.info.pid,\r\n            <FlowSidebar key={+new Date()}\r\n                info={this.state.info} replies={this.state.replies} attention={this.state.attention} sync_state={this.setState.bind(this)}\r\n                token={this.props.token} show_sidebar={this.props.show_sidebar} color_picker={this.color_picker}\r\n                deletion_detect={this.props.deletion_detect}\r\n            />\r\n        );\r\n    }\r\n\r\n    render() {\r\n        let show_pid=load_single_meta(this.props.show_sidebar,this.props.token,[this.state.info.pid]);\r\n\r\n        let hl_rules=[\r\n            ['url_pid',URL_PID_RE],\r\n            ['url',URL_RE],\r\n            ['pid',PID_RE],\r\n            ['nickname',NICKNAME_RE],\r\n        ];\r\n        if(this.props.search_param)\r\n            hl_rules.push(['search',build_highlight_re(this.props.search_param,' ','gi')]);\r\n        let parts=split_text(this.state.info.text,hl_rules);\r\n\r\n        let quote_id=null;\r\n        if(!this.props.is_quote)\r\n            for(let [mode,content] of parts)\r\n                if(mode==='pid' && QUOTE_BLACKLIST.indexOf(content)===-1 && parseInt(content)<parseInt(this.state.info.pid))\r\n                    if(quote_id===null)\r\n                        quote_id=parseInt(content);\r\n                    else {\r\n                        quote_id=null;\r\n                        break;\r\n                    }\r\n\r\n        let res=(\r\n            <div className={'flow-item-row flow-item-row-with-prompt'+(this.props.is_quote ? ' flow-item-row-quote' : '')} onClick={(event)=>{\r\n                if(!CLICKABLE_TAGS[event.target.tagName.toLowerCase()])\r\n                    this.show_sidebar();\r\n            }}>\r\n                <FlowItem parts={parts} info={this.state.info} attention={this.state.attention} img_clickable={false} is_quote={this.props.is_quote}\r\n                    color_picker={this.color_picker} show_pid={show_pid} replies={this.state.replies} />\r\n                <div className=\"flow-reply-row\">\r\n                    {this.state.reply_status==='loading' && <div className=\"box box-tip\">加载中</div>}\r\n                    {this.state.reply_status==='failed' &&\r\n                        <div className=\"box box-tip\">\r\n                            <p><a onClick={()=>{this.load_replies()}}>重新加载评论</a></p>\r\n                            <p>{this.state.reply_error}</p>\r\n                        </div>\r\n                    }\r\n                    {this.state.reply_status==='captcha' &&\r\n                        <div className=\"box box-tip\">\r\n                            <CaptchaClient onFinish={()=>this.load_replies()} />\r\n                        </div>\r\n                    }\r\n                    {this.state.replies.slice(0,PREVIEW_REPLY_COUNT).map((reply)=>(\r\n                        <Reply key={reply.cid} info={reply} color_picker={this.color_picker} show_pid={show_pid} />\r\n                    ))}\r\n                    {this.state.replies.length>PREVIEW_REPLY_COUNT &&\r\n                        <div className=\"box box-tip\">还有 {this.state.replies.length-PREVIEW_REPLY_COUNT} 条</div>\r\n                    }\r\n                </div>\r\n            </div>\r\n        );\r\n\r\n        return quote_id ? (\r\n            <div>\r\n                {res}\r\n                <FlowItemQuote pid={quote_id} show_sidebar={this.props.show_sidebar} token={this.props.token}\r\n                    deletion_detect={this.props.deletion_detect} />\r\n            </div>\r\n        ) : res;\r\n    }\r\n}\r\n\r\nclass FlowItemQuote extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            loading_status: 'empty',\r\n            error_msg: null,\r\n            info: null,\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.load();\r\n    }\r\n\r\n    load() {\r\n        this.setState({\r\n            loading_status: 'loading',\r\n        },()=>{\r\n            API.get_single(this.props.pid,this.props.token)\r\n                .then((json)=>{\r\n                    this.setState({\r\n                        loading_status: 'done',\r\n                        info: json.data,\r\n                    });\r\n                })\r\n                .catch((err)=>{\r\n                    if((''+err).indexOf('没有这条树洞')!==-1)\r\n                        this.setState({\r\n                            loading_status: 'empty',\r\n                        });\r\n                    else\r\n                        this.setState({\r\n                            loading_status: 'error',\r\n                            error_msg: ''+err,\r\n                        });\r\n                });\r\n        });\r\n    }\r\n\r\n    render() {\r\n        if(this.state.loading_status==='empty')\r\n            return null;\r\n        else if(this.state.loading_status==='loading')\r\n            return (\r\n                <div className=\"aux-margin\">\r\n                    <div className=\"box box-tip\">\r\n                        <span className=\"icon icon-loading\" />\r\n                        提到了 #{this.props.pid}\r\n                    </div>\r\n                </div>\r\n            );\r\n        else if(this.state.loading_status==='error')\r\n            return (\r\n                <div className=\"aux-margin\">\r\n                    <div className=\"box box-tip\">\r\n                        <p><a onClick={this.load.bind(this)}>重新加载</a></p>\r\n                        <p>{this.state.error_msg}</p>\r\n                    </div>\r\n                </div>\r\n            );\r\n        else // 'done'\r\n            return (\r\n                <FlowItemRow info={this.state.info} show_sidebar={this.props.show_sidebar} token={this.props.token}\r\n                    is_quote={true} deletion_detect={this.props.deletion_detect} />\r\n            );\r\n    }\r\n}\r\n\r\nfunction FlowChunk(props) {\r\n    return (\r\n        <TokenCtx.Consumer>{({value: token})=>(\r\n            <div className=\"flow-chunk\">\r\n                {!!props.title && <TitleLine text={props.title} />}\r\n                {props.list.map((info,ind)=>(\r\n                    <LazyLoad key={info.pid} offset={1500} height=\"15em\" hiddenIfInvisible={true}>\r\n                        <div>\r\n                            {!!(props.deletion_detect && props.mode==='list' && ind && props.list[ind-1].pid-info.pid>1) &&\r\n                                <div className=\"flow-item-row\">\r\n                                    <div className=\"box box-tip flow-item box-danger\">\r\n                                        {props.list[ind-1].pid-info.pid-1} 条被删除\r\n                                    </div>\r\n                                </div>\r\n                            }\r\n                            <FlowItemRow info={info} show_sidebar={props.show_sidebar} token={token}\r\n                                    attention_override={props.mode==='attention_finished' ? true : null}\r\n                                    deletion_detect={props.deletion_detect} search_param={props.search_param} />\r\n                        </div>\r\n                    </LazyLoad>\r\n                ))}\r\n            </div>\r\n        )}</TokenCtx.Consumer>\r\n    );\r\n}\r\n\r\nexport class Flow extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            mode: props.mode,\r\n            search_param: props.search_text,\r\n            loaded_pages: 0,\r\n            chunks: {\r\n                title: '',\r\n                data: [],\r\n            },\r\n            loading_status: 'done',\r\n            error_msg: null,\r\n        };\r\n        this.on_scroll_bound=this.on_scroll.bind(this);\r\n        window.LATEST_POST_ID=parseInt(localStorage['_LATEST_POST_ID'],10)||0;\r\n    }\r\n\r\n    load_page(page) {\r\n        const failed=(err)=>{\r\n            console.error(err);\r\n            this.setState((prev,props)=>({\r\n                loaded_pages: prev.loaded_pages-1,\r\n                loading_status: 'failed',\r\n                error_msg: ''+err,\r\n            }));\r\n        };\r\n\r\n        if(page>this.state.loaded_pages+1)\r\n            throw new Error('bad page');\r\n        if(page===this.state.loaded_pages+1) {\r\n            console.log('fetching page',page);\r\n            if(this.state.mode==='list') {\r\n                API.get_list(page,this.props.token)\r\n                    .then((json)=>{\r\n                        if(page===1 && json.data.length) { // update latest_post_id\r\n                            let max_id=-1;\r\n                            json.data.forEach((x)=>{\r\n                                if(parseInt(x.pid,10)>max_id)\r\n                                    max_id=parseInt(x.pid,10);\r\n                            });\r\n                            localStorage['_LATEST_POST_ID']=''+max_id;\r\n                        }\r\n                        this.setState((prev,props)=>({\r\n                            chunks: {\r\n                                title: 'News Feed',\r\n                                data: prev.chunks.data.concat(json.data.filter((x)=>(\r\n                                    prev.chunks.data.length===0 ||\r\n                                    !(prev.chunks.data.slice(-100).some((p)=>p.pid===x.pid))\r\n                                ))),\r\n                            },\r\n                            loading_status: 'done',\r\n                        }));\r\n                    })\r\n                    .catch(failed);\r\n            } else if(this.state.mode==='search') {\r\n                API.get_search(page,this.state.search_param,this.props.token)\r\n                    .then((json)=>{\r\n                        const finished=json.data.length===0;\r\n                        this.setState((prev,props)=>({\r\n                            chunks: {\r\n                                title: 'Result for \"'+this.state.search_param+'\"',\r\n                                data: prev.chunks.data.concat(json.data.filter((x)=>(\r\n                                    prev.chunks.data.length===0 ||\r\n                                    !(prev.chunks.data.slice(-100).some((p)=>p.pid===x.pid))\r\n                                ))),\r\n                            },\r\n                            mode: finished ? 'search_finished' : 'search',\r\n                            loading_status: 'done',\r\n                        }));\r\n                    })\r\n                    .catch(failed);\r\n            } else if(this.state.mode==='single') {\r\n                const pid=parseInt(this.state.search_param.substr(1),10);\r\n                API.get_single(pid,this.props.token)\r\n                    .then((json)=>{\r\n                        this.setState({\r\n                            chunks: {\r\n                                title: 'PID = '+pid,\r\n                                data: [json.data],\r\n                            },\r\n                            mode: 'single_finished',\r\n                            loading_status: 'done',\r\n                        });\r\n                    })\r\n                    .catch(failed);\r\n            } else if(this.state.mode==='attention') {\r\n                API.get_attention(this.props.token)\r\n                    .then((json)=>{\r\n                        this.setState({\r\n                            chunks: {\r\n                                title: 'Attention List',\r\n                                data: json.data,\r\n                            },\r\n                            mode: 'attention_finished',\r\n                            loading_status: 'done',\r\n                        });\r\n                    })\r\n                    .catch(failed);\r\n            } else {\r\n                console.log('nothing to load');\r\n                return;\r\n            }\r\n\r\n            this.setState((prev,props)=>({\r\n                loaded_pages: prev.loaded_pages+1,\r\n                loading_status: 'loading',\r\n                error_msg: null,\r\n            }));\r\n        }\r\n    }\r\n\r\n    on_scroll(event) {\r\n        if(event.target===document) {\r\n            const avail=document.body.scrollHeight-window.scrollY-window.innerHeight;\r\n            if(avail<window.innerHeight && this.state.loading_status==='done')\r\n                this.load_page(this.state.loaded_pages+1);\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.load_page(1);\r\n        window.addEventListener('scroll',this.on_scroll_bound);\r\n        window.addEventListener('resize',this.on_scroll_bound);\r\n    }\r\n    componentWillUnmount() {\r\n        window.removeEventListener('scroll',this.on_scroll_bound);\r\n        window.removeEventListener('resize',this.on_scroll_bound);\r\n    }\r\n\r\n    render() {\r\n        const should_deletion_detect=localStorage['DELETION_DETECT']==='on';\r\n        return (\r\n            <div className=\"flow-container\">\r\n                <FlowChunk\r\n                    title={this.state.chunks.title} list={this.state.chunks.data} mode={this.state.mode}\r\n                    search_param={this.state.search_param||null}\r\n                    show_sidebar={this.props.show_sidebar} deletion_detect={should_deletion_detect}\r\n                />\r\n                {this.state.loading_status==='failed' &&\r\n                    <div className=\"aux-margin\">\r\n                        <div className=\"box box-tip\">\r\n                            <p><a onClick={()=>{this.load_page(this.state.loaded_pages+1)}}>重新加载</a></p>\r\n                            <p>{this.state.error_msg}</p>\r\n                        </div>\r\n                    </div>\r\n                }\r\n                <TitleLine text={\r\n                    this.state.loading_status==='loading' ?\r\n                        <span><span className=\"icon icon-loading\" />&nbsp;Loading...</span> :\r\n                        '© xmcp'\r\n                } />\r\n            </div>\r\n        );\r\n    }\r\n}","import React, {Component, PureComponent} from 'react';\r\nimport {AppSwitcher} from './infrastructure/widgets';\r\nimport {InfoSidebar, PostForm} from './UserAction';\r\nimport {TokenCtx} from './UserAction';\r\n\r\nimport './Title.css';\r\n\r\nconst flag_re=/^\\/\\/setflag ([a-zA-Z0-9_]+)=(.*)$/;\r\n\r\nclass ControlBar extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            search_text: '',\r\n        };\r\n        this.set_mode=props.set_mode;\r\n\r\n        this.on_change_bound=this.on_change.bind(this);\r\n        this.on_keypress_bound=this.on_keypress.bind(this);\r\n        this.do_refresh_bound=this.do_refresh.bind(this);\r\n        this.do_attention_bound=this.do_attention.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        if(window.location.hash) {\r\n            let text=decodeURIComponent(window.location.hash).substr(1);\r\n            if(text.lastIndexOf('?')!==-1)\r\n                text=text.substr(0,text.lastIndexOf('?')); // fuck wechat '#param?nsukey=...'\r\n            this.setState({\r\n                search_text: text,\r\n            }, ()=>{\r\n                this.on_keypress({key: 'Enter'});\r\n            });\r\n        }\r\n    }\r\n\r\n    on_change(event) {\r\n        this.setState({\r\n            search_text: event.target.value,\r\n        });\r\n    }\r\n\r\n    on_keypress(event) {\r\n        if(event.key==='Enter') {\r\n            let flag_res=flag_re.exec(this.state.search_text);\r\n            if(flag_res) {\r\n                if(flag_res[2]) {\r\n                    localStorage[flag_res[1]]=flag_res[2];\r\n                    alert('Set Flag '+flag_res[1]+'='+flag_res[2]+'\\nYou may need to refresh this webpage.');\r\n                } else {\r\n                    delete localStorage[flag_res[1]];\r\n                    alert('Clear Flag '+flag_res[1]+'\\nYou may need to refresh this webpage.');\r\n                }\r\n                return;\r\n            }\r\n\r\n            const mode=this.state.search_text.startsWith('#') ? 'single' : 'search';\r\n            this.set_mode(mode,this.state.search_text||'');\r\n        }\r\n    }\r\n\r\n    do_refresh() {\r\n        window.scrollTo(0,0);\r\n        this.setState({\r\n            search_text: '',\r\n        });\r\n        this.set_mode('list',null);\r\n    }\r\n\r\n    do_attention() {\r\n        window.scrollTo(0,0);\r\n        this.setState({\r\n            search_text: '',\r\n        });\r\n        this.set_mode('attention',null);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <TokenCtx.Consumer>{({value: token})=>(\r\n                <div className=\"control-bar\">\r\n                    <a className=\"no-underline control-btn\" onClick={this.do_refresh_bound}>\r\n                        <span className=\"icon icon-refresh\" />\r\n                        <span className=\"control-btn-label\">最新</span>\r\n                    </a>\r\n                    {!!token &&\r\n                        <a className=\"no-underline control-btn\" onClick={this.do_attention_bound}>\r\n                            <span className=\"icon icon-attention\" />\r\n                            <span className=\"control-btn-label\">关注</span>\r\n                        </a>\r\n                    }\r\n                    <input className=\"control-search\" value={this.state.search_text} placeholder=\"搜索 或 #PID\"\r\n                           onChange={this.on_change_bound} onKeyPress={this.on_keypress_bound}\r\n                    />\r\n                    <a className=\"no-underline control-btn\" onClick={()=>{\r\n                        this.props.show_sidebar(\r\n                            'Q小树洞',\r\n                            <InfoSidebar show_sidebar={this.props.show_sidebar} />\r\n                        )\r\n                    }}>\r\n                        <span className={'icon icon-'+(token ? 'about' : 'login')} />\r\n                        <span className=\"control-btn-label\">{token ? '账户' : '登录'}</span>\r\n                    </a>\r\n                    {!!token &&\r\n                        <a className=\"no-underline control-btn\" onClick={()=>{\r\n                            this.props.show_sidebar(\r\n                                '发表树洞',\r\n                                <PostForm token={token} on_complete={()=>{\r\n                                    this.props.show_sidebar(null,null,'clear');\r\n                                    this.do_refresh();\r\n                                }} />\r\n                            )\r\n                        }}>\r\n                            <span className=\"icon icon-plus\" />\r\n                            <span className=\"control-btn-label\">发表</span>\r\n                        </a>\r\n                    }\r\n                </div>\r\n            )}</TokenCtx.Consumer>\r\n        )\r\n    }\r\n}\r\n\r\nexport function Title(props) {\r\n    return (\r\n        <div className=\"title-bar\">\r\n            <AppSwitcher appid=\"hole\" />\r\n            <div className=\"aux-margin\">\r\n                <div className=\"title\">\r\n                    <p className=\"centered-line\">\r\n                        <span onClick={()=>props.show_sidebar(\r\n                            'Q小树洞',\r\n                            <InfoSidebar show_sidebar={props.show_sidebar} />\r\n                        )}>\r\n                            Q小树洞\r\n                        </span>\r\n                    </p>\r\n                </div>\r\n                <ControlBar show_sidebar={props.show_sidebar} set_mode={props.set_mode} />\r\n            </div>\r\n        </div>\r\n    )\r\n}","import React, {Component, PureComponent} from 'react';\r\nimport './Sidebar.css';\r\n\r\nexport class Sidebar extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n        this.sidebar_ref=React.createRef();\r\n        this.do_close_bound=this.do_close.bind(this);\r\n        this.do_back_bound=this.do_back.bind(this);\r\n    }\r\n\r\n    componentDidUpdate(nextProps) {\r\n        if(this.props.stack!==nextProps.stack) {\r\n            //console.log('sidebar top');\r\n            if(this.sidebar_ref.current)\r\n                this.sidebar_ref.current.scrollTop=0;\r\n        }\r\n    }\r\n\r\n    do_close() {\r\n        this.props.show_sidebar(null,null,'clear');\r\n    }\r\n    do_back() {\r\n        this.props.show_sidebar(null,null,'pop');\r\n    }\r\n\r\n    render() {\r\n        let [cur_title,cur_content]=this.props.stack[this.props.stack.length-1];\r\n        return (\r\n            <div className={'sidebar-container '+(cur_title!==null ? 'sidebar-on' : 'sidebar-off')}>\r\n                <div className=\"sidebar-shadow\" onClick={this.do_back_bound} onTouchEnd={(e)=>{e.preventDefault();e.target.click();}} />\r\n                <div ref={this.sidebar_ref} className=\"sidebar\">\r\n                    {cur_content}\r\n                </div>\r\n                <div className=\"sidebar-title\">\r\n                    <a className=\"no-underline\" onClick={this.do_close_bound}>&nbsp;<span className=\"icon icon-close\" />&nbsp;</a>\r\n                    {this.props.stack.length>2 &&\r\n                        <a className=\"no-underline\" onClick={this.do_back_bound}>&nbsp;<span className=\"icon icon-back\" />&nbsp;</a>\r\n                    }\r\n                    {cur_title}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}","import React, {Component} from 'react';\r\nimport Pressure from 'pressure';\r\n\r\nimport './PressureHelper.css';\r\n\r\nconst THRESHOLD=.4;\r\nconst MULTIPLIER=25;\r\nconst BORDER_WIDTH=500; // also change css!\r\n\r\nexport class PressureHelper extends  Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state={\r\n            level: 0,\r\n            fired: false,\r\n        };\r\n        this.callback=props.callback;\r\n        this.esc_interval=null;\r\n    }\r\n\r\n    do_fire() {\r\n        if(this.esc_interval) {\r\n            clearInterval(this.esc_interval);\r\n            this.esc_interval=null;\r\n        }\r\n        this.setState({\r\n            level: 1,\r\n            fired: true,\r\n        });\r\n        this.callback();\r\n        window.setTimeout(()=>{\r\n            this.setState({\r\n                level: 0,\r\n                fired: false,\r\n            });\r\n        },300);\r\n    }\r\n\r\n    componentDidMount() {\r\n        if(window.config.pressure) {\r\n            Pressure.set(document.body, {\r\n                change: (force)=>{\r\n                    if(!this.state.fired) {\r\n                        if(force>=.999) {\r\n                            this.do_fire();\r\n                        }\r\n                        else\r\n                            this.setState({\r\n                                level: force,\r\n                            });\r\n                    }\r\n                },\r\n                end: ()=>{\r\n                    this.setState({\r\n                        level: 0,\r\n                        fired: false,\r\n                    });\r\n                },\r\n            }, {\r\n                polyfill: false,\r\n                only: 'touch',\r\n                preventSelect: false,\r\n            });\r\n\r\n            document.addEventListener('keydown',(e)=>{\r\n                if(!e.repeat && e.key==='Escape') {\r\n                    if(this.esc_interval)\r\n                        clearInterval(this.esc_interval);\r\n                    this.setState({\r\n                        level: THRESHOLD/2,\r\n                    },()=>{\r\n                        this.esc_interval=setInterval(()=>{\r\n                            let new_level=this.state.level+.1;\r\n                            if(new_level>=.999)\r\n                                this.do_fire();\r\n                            else\r\n                                this.setState({\r\n                                    level: new_level,\r\n                                });\r\n                        },30);\r\n                    });\r\n                }\r\n            });\r\n            document.addEventListener('keyup',(e)=>{\r\n                if(e.key==='Escape') {\r\n                    if(this.esc_interval) {\r\n                        clearInterval(this.esc_interval);\r\n                        this.esc_interval=null;\r\n                    }\r\n                    this.setState({\r\n                        level: 0,\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const pad=MULTIPLIER*(this.state.level-THRESHOLD)-BORDER_WIDTH;\r\n        return (\r\n            <div className={\r\n                'pressure-box'\r\n                +(this.state.fired ? ' pressure-box-fired' : '')\r\n                +(this.state.level<=.0001 ? ' pressure-box-empty' : '')\r\n            } style={{\r\n                left: pad,\r\n                right: pad,\r\n                top: pad,\r\n                bottom: pad,\r\n            }} />\r\n        )\r\n    }\r\n}","import React, {Component} from 'react';\r\nimport {Flow} from './Flows';\r\nimport {Title} from './Title';\r\nimport {Sidebar} from './Sidebar';\r\nimport {PressureHelper} from './PressureHelper';\r\nimport {TokenCtx} from './UserAction';\r\nimport {load_config,bgimg_style} from './Config';\r\nimport {listen_darkmode} from './infrastructure/functions';\r\nimport {LoginPopup, TitleLine} from './infrastructure/widgets';\r\nimport {cache} from './cache';\r\nimport {CaptchaRoot} from './Captcha';\r\n\r\nconst MAX_SIDEBAR_STACK_SIZE=10;\r\n\r\nfunction DeprecatedAlert(props) {\r\n    return (\r\n        <div id=\"global-hint-container\" style={{display: 'none'}} />\r\n    );\r\n}\r\n\r\nclass App extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        load_config();\r\n        listen_darkmode({default: undefined, light: false, dark: true}[window.config.color_scheme]);\r\n        this.state={\r\n            sidebar_stack: [[null,null]], // list of [status, content]\r\n            mode: 'list', // list, single, search, attention\r\n            search_text: null,\r\n            flow_render_key: +new Date(),\r\n            token: localStorage['TOKEN']||null,\r\n        };\r\n        this.show_sidebar_bound=this.show_sidebar.bind(this);\r\n        this.set_mode_bound=this.set_mode.bind(this);\r\n        this.on_pressure_bound=this.on_pressure.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        cache(); // init indexeddb\r\n    }\r\n\r\n    static is_darkmode() {\r\n        if(window.config.color_scheme==='dark') return true;\r\n        if(window.config.color_scheme==='light') return false;\r\n        else { // 'default'\r\n            return window.matchMedia('(prefers-color-scheme: dark)').matches;\r\n        }\r\n    }\r\n\r\n    on_pressure() {\r\n        if(this.state.sidebar_stack.length>1)\r\n            this.show_sidebar(null,null,'clear');\r\n        else\r\n            this.set_mode('list',null);\r\n    }\r\n\r\n    show_sidebar(title,content,mode='push') {\r\n        this.setState((prevState)=>{\r\n            let ns=prevState.sidebar_stack.slice();\r\n            if(mode==='push') {\r\n                if(ns.length>MAX_SIDEBAR_STACK_SIZE)\r\n                    ns.splice(1,1);\r\n                ns=ns.concat([[title,content]]);\r\n            } else if(mode==='pop') {\r\n                if(ns.length===1) return;\r\n                ns.pop();\r\n            } else if(mode==='replace') {\r\n                ns.pop();\r\n                ns=ns.concat([[title,content]]);\r\n            } else if(mode==='clear') {\r\n                ns=[[null,null]];\r\n            } else\r\n                throw new Error('bad show_sidebar mode');\r\n            return {\r\n                sidebar_stack: ns,\r\n            };\r\n        });\r\n    }\r\n\r\n    set_mode(mode,search_text) {\r\n        this.setState({\r\n            mode: mode,\r\n            search_text: search_text,\r\n            flow_render_key: +new Date(),\r\n        });\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <TokenCtx.Provider value={{\r\n                value: this.state.token,\r\n                set_value: (x)=>{\r\n                    localStorage['TOKEN']=x||'';\r\n                    this.setState({\r\n                        token: x,\r\n                    });\r\n                },\r\n            }}><CaptchaRoot>\r\n                <PressureHelper callback={this.on_pressure_bound} />\r\n                <div className=\"bg-img\" style={bgimg_style()} />\r\n                <Title show_sidebar={this.show_sidebar_bound} set_mode={this.set_mode_bound} />\r\n                <TokenCtx.Consumer>{(token)=>(\r\n                    <div className=\"left-container\">\r\n                        <DeprecatedAlert token={token.value} />\r\n                        {!token.value &&\r\n                            <div className=\"flow-item-row aux-margin\">\r\n                                <div className=\"box box-tip\">\r\n                                    <p>\r\n                                        <LoginPopup token_callback={token.set_value}>{(do_popup)=>(\r\n                                            <a onClick={do_popup}>\r\n                                                <span className=\"icon icon-login\" />\r\n                                                &nbsp;登录到 Q小树洞\r\n                                            </a>\r\n                                        )}</LoginPopup>\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                        }\r\n                        <Flow key={this.state.flow_render_key} show_sidebar={this.show_sidebar_bound}\r\n                              mode={this.state.mode} search_text={this.state.search_text} token={token.value}\r\n                        />\r\n                        <br />\r\n                    </div>\r\n                )}</TokenCtx.Consumer>\r\n                <Sidebar show_sidebar={this.show_sidebar_bound} stack={this.state.sidebar_stack} />\r\n            </CaptchaRoot></TokenCtx.Provider>\r\n        );\r\n    }\r\n}\r\n\r\nexport default App;\r\n","// In production, we register a service worker to serve assets from local cache.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\r\n// cached resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\r\n// This link also includes instructions on opting out of this behavior.\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport default function register() {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Lets check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not local host. Just register service worker\r\n        registerValidSW(swUrl);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the old content will have been purged and\r\n              // the fresh content will have been added to the cache.\r\n              // It's the perfect time to display a \"New content is\r\n              // available; please refresh.\" message in your web app.\r\n              console.log('New content is available; please refresh.');\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      if (\r\n        response.status === 404 ||\r\n        response.headers.get('content-type').indexOf('javascript') === -1\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\n//import {elevate} from './infrastructure/elevator';\r\nimport registerServiceWorker from './registerServiceWorker';\r\n\r\n//elevate();\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\nregisterServiceWorker();\r\n"],"sourceRoot":""}